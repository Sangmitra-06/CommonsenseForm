{"ast":null,"code":"import _objectSpread from\"C:/Users/sangm/OneDrive - Brock University/CommonsenseForm/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useReducer,useEffect,useCallback,useRef,useState}from'react';import{loadQuestionsData}from'../utils/helpers.ts';import*as api from'../services/api.ts';// Timer constants\nimport{jsx as _jsx}from\"react/jsx-runtime\";const SURVEY_TIME_LIMIT=1*60*1000;// 15 minutes in milliseconds\nconst WARNING_TIME_REMAINING=2*60*1000;// Show warning at 2 minutes remaining\nconst CRITICAL_TIME_REMAINING=30*1000;// Show critical warning at 30 seconds\nconst initialState={sessionId:null,userInfo:null,currentPosition:{categoryIndex:0,subcategoryIndex:0,topicIndex:0,questionIndex:0},responses:new Map(),progress:{currentCategory:0,currentSubcategory:0,currentTopic:0,currentQuestion:0,completedQuestions:0,totalQuestions:0,completedTopics:[],attentionChecksPassed:0,attentionChecksFailed:0},isLoading:false,error:null,questionsData:[],startTime:0,lastSaveTime:0,isCompleted:false,// Timer state\nsurveyStartTime:0,surveyTimeLimit:SURVEY_TIME_LIMIT,surveyTimeRemaining:SURVEY_TIME_LIMIT,showTimeWarning:false,showTimeCritical:false,surveyExpired:false};function formReducer(state,action){switch(action.type){case'SET_LOADING':return _objectSpread(_objectSpread({},state),{},{isLoading:action.payload});case'SET_ERROR':return _objectSpread(_objectSpread({},state),{},{error:action.payload});case'SET_SESSION_ID':return _objectSpread(_objectSpread({},state),{},{sessionId:action.payload});case'SET_USER_INFO':return _objectSpread(_objectSpread({},state),{},{userInfo:action.payload});case'SET_QUESTIONS_DATA':return _objectSpread(_objectSpread({},state),{},{questionsData:action.payload});case'SET_CURRENT_POSITION':return _objectSpread(_objectSpread({},state),{},{currentPosition:action.payload});case'ADD_RESPONSE':const newResponses=new Map(state.responses);newResponses.set(action.payload.questionId,action.payload);return _objectSpread(_objectSpread({},state),{},{responses:newResponses});case'UPDATE_PROGRESS':return _objectSpread(_objectSpread({},state),{},{progress:_objectSpread(_objectSpread({},state.progress),action.payload)});case'SET_RESPONSES':const responseMap=new Map();action.payload.forEach(response=>{responseMap.set(response.questionId,response);});return _objectSpread(_objectSpread({},state),{},{responses:responseMap});case'SET_START_TIME':return _objectSpread(_objectSpread({},state),{},{startTime:action.payload});case'SET_LAST_SAVE_TIME':return _objectSpread(_objectSpread({},state),{},{lastSaveTime:action.payload});case'SET_COMPLETED':return _objectSpread(_objectSpread({},state),{},{isCompleted:action.payload});case'RESET_FORM':return _objectSpread(_objectSpread({},initialState),{},{questionsData:state.questionsData});// Timer cases\ncase'START_SURVEY_TIMER':return _objectSpread(_objectSpread({},state),{},{surveyStartTime:Date.now(),surveyTimeRemaining:state.surveyTimeLimit,showTimeWarning:false,showTimeCritical:false,surveyExpired:false});case'UPDATE_TIMER':return _objectSpread(_objectSpread({},state),{},{surveyTimeRemaining:action.payload.timeRemaining,showTimeWarning:action.payload.showWarning,showTimeCritical:action.payload.showCritical});case'EXPIRE_SURVEY':return _objectSpread(_objectSpread({},state),{},{surveyExpired:true,surveyTimeRemaining:0,isCompleted:true});default:return state;}}// Updated interface\nconst FormContext=/*#__PURE__*/createContext(undefined);export function FormProvider(_ref){let{children}=_ref;const[state,dispatch]=useReducer(formReducer,initialState);const hasLoadedQuestions=useRef(false);const isLoadingSession=useRef(false);const[timerInterval,setTimerInterval]=useState(null);const surveyStartTimeRef=useRef(0);// Add this ref to track start time\n// Load questions data only once\nuseEffect(()=>{if(hasLoadedQuestions.current)return;const loadData=async()=>{try{hasLoadedQuestions.current=true;dispatch({type:'SET_LOADING',payload:true});dispatch({type:'SET_ERROR',payload:null});console.log('FormContext: Loading questions data...');const data=await loadQuestionsData();console.log('FormContext: Questions loaded:',data.length,'categories');dispatch({type:'SET_QUESTIONS_DATA',payload:data});const totalQuestions=getTotalQuestions(data);console.log('FormContext: Total questions calculated:',totalQuestions);dispatch({type:'UPDATE_PROGRESS',payload:{totalQuestions}});}catch(error){console.error('FormContext: Error loading questions:',error);dispatch({type:'SET_ERROR',payload:'Failed to load questions data. Please refresh the page.'});hasLoadedQuestions.current=false;}finally{dispatch({type:'SET_LOADING',payload:false});}};loadData();},[]);// Calculate total questions\nconst getTotalQuestions=questionsData=>{return questionsData.reduce((total,category)=>{return total+category.subcategories.reduce((subTotal,subcategory)=>{return subTotal+subcategory.topics.reduce((topicTotal,topic)=>{return topicTotal+topic.questions.length;},0);},0);},0);};// Auto-complete survey when time expires\nconst completeExpiredSurvey=useCallback(async()=>{if(state.sessionId){try{console.log('Survey time expired, auto-completing...');await api.completeUser(state.sessionId);dispatch({type:'SET_COMPLETED',payload:true});}catch(error){console.error('Error auto-completing expired survey:',error);}}},[state.sessionId]);// FIXED: Start timer function\nconst startSurveyTimer=useCallback(()=>{const startTime=Date.now();console.log('Starting survey timer at:',new Date(startTime).toISOString());// Update both state and ref\ndispatch({type:'START_SURVEY_TIMER'});surveyStartTimeRef.current=startTime;// Clear any existing timer\nif(timerInterval){clearInterval(timerInterval);}// Start new timer using the ref value\nconst interval=setInterval(()=>{const now=Date.now();const elapsed=now-surveyStartTimeRef.current;// Use ref instead of state\nconst remaining=Math.max(0,SURVEY_TIME_LIMIT-elapsed);console.log('Timer update:',{elapsed:Math.floor(elapsed/1000)+'s',remaining:Math.floor(remaining/1000)+'s'});const showWarning=remaining<=WARNING_TIME_REMAINING&&remaining>CRITICAL_TIME_REMAINING;const showCritical=remaining<=CRITICAL_TIME_REMAINING&&remaining>0;if(remaining<=0){console.log('Timer expired!');dispatch({type:'EXPIRE_SURVEY'});clearInterval(interval);setTimerInterval(null);completeExpiredSurvey();}else{dispatch({type:'UPDATE_TIMER',payload:{timeRemaining:remaining,showWarning,showCritical}});}},1000);// Update every second\nsetTimerInterval(interval);},[timerInterval,completeExpiredSurvey]);// FIXED: Resume timer function\nconst resumeSurveyTimer=useCallback(startTime=>{console.log('Resuming survey timer from:',new Date(startTime).toISOString());const now=Date.now();const elapsed=now-startTime;const remaining=Math.max(0,SURVEY_TIME_LIMIT-elapsed);console.log('Resume timer:',{startTime:new Date(startTime).toISOString(),elapsed:Math.floor(elapsed/1000)+'s',remaining:Math.floor(remaining/1000)+'s'});if(remaining<=0){console.log('Survey already expired on resume');dispatch({type:'EXPIRE_SURVEY'});completeExpiredSurvey();return;}// Set the ref to the original start time\nsurveyStartTimeRef.current=startTime;// Update state\ndispatch({type:'UPDATE_TIMER',payload:{timeRemaining:remaining,showWarning:remaining<=WARNING_TIME_REMAINING,showCritical:remaining<=CRITICAL_TIME_REMAINING}});// Clear any existing timer\nif(timerInterval){clearInterval(timerInterval);}// Start timer with correct start time\nconst interval=setInterval(()=>{const now=Date.now();const elapsed=now-surveyStartTimeRef.current;// Use the original start time\nconst remaining=Math.max(0,SURVEY_TIME_LIMIT-elapsed);const showWarning=remaining<=WARNING_TIME_REMAINING&&remaining>CRITICAL_TIME_REMAINING;const showCritical=remaining<=CRITICAL_TIME_REMAINING&&remaining>0;if(remaining<=0){dispatch({type:'EXPIRE_SURVEY'});clearInterval(interval);setTimerInterval(null);completeExpiredSurvey();}else{dispatch({type:'UPDATE_TIMER',payload:{timeRemaining:remaining,showWarning,showCritical}});}},1000);setTimerInterval(interval);},[timerInterval,completeExpiredSurvey]);// Clean up timer on unmount\nuseEffect(()=>{return()=>{if(timerInterval){clearInterval(timerInterval);}};},[timerInterval]);// FIXED: Format time function\nconst formatTimeRemaining=useCallback(milliseconds=>{const totalSeconds=Math.max(0,Math.floor(milliseconds/1000));const minutes=Math.floor(totalSeconds/60);const seconds=totalSeconds%60;return\"\".concat(minutes,\":\").concat(seconds.toString().padStart(2,'0'));},[]);// FIXED: Create user session\nconst createUserSession=useCallback(async userInfo=>{try{dispatch({type:'SET_LOADING',payload:true});const response=await api.createUser(userInfo);dispatch({type:'SET_SESSION_ID',payload:response.sessionId});dispatch({type:'SET_USER_INFO',payload:userInfo});const startTime=Date.now();dispatch({type:'SET_START_TIME',payload:startTime});// Store session ID and start time in localStorage\nlocalStorage.setItem('culturalSurveySessionId',response.sessionId);localStorage.setItem('culturalSurveyStartTime',startTime.toString());// Start the survey timer\nconsole.log('Creating user session and starting timer');startSurveyTimer();}catch(error){dispatch({type:'SET_ERROR',payload:'Failed to create user session'});throw error;}finally{dispatch({type:'SET_LOADING',payload:false});}},[startSurveyTimer]);const loadUserSession=useCallback(async sessionId=>{if(isLoadingSession.current)return;try{isLoadingSession.current=true;dispatch({type:'SET_LOADING',payload:true});console.log('FormContext: Loading user session...');const user=await api.getUser(sessionId);dispatch({type:'SET_SESSION_ID',payload:sessionId});dispatch({type:'SET_USER_INFO',payload:user.userInfo});dispatch({type:'SET_COMPLETED',payload:user.isCompleted});// Load responses\nconsole.log('FormContext: Loading user responses...');const responses=await api.getUserResponses(sessionId);console.log('FormContext: Responses loaded:',responses.length);dispatch({type:'SET_RESPONSES',payload:responses});// Recalculate total questions from current data\nconst totalQuestions=getTotalQuestions(state.questionsData);const updatedProgress=_objectSpread(_objectSpread({},user.progress),{},{totalQuestions,completedQuestions:responses.length});dispatch({type:'UPDATE_PROGRESS',payload:updatedProgress});// Find the correct starting position\nconst nextPosition=findNextUnansweredQuestion(responses,state.questionsData);console.log('FormContext: Setting position to:',nextPosition);dispatch({type:'SET_CURRENT_POSITION',payload:nextPosition});// Resume timer if not completed\nif(!user.isCompleted){const savedStartTime=localStorage.getItem('culturalSurveyStartTime');if(savedStartTime){resumeSurveyTimer(parseInt(savedStartTime));}else{// If no start time found, start fresh timer\nlocalStorage.setItem('culturalSurveyStartTime',Date.now().toString());startSurveyTimer();}}}catch(error){dispatch({type:'SET_ERROR',payload:'Failed to load user session'});throw error;}finally{dispatch({type:'SET_LOADING',payload:false});isLoadingSession.current=false;}},[state.questionsData,resumeSurveyTimer,startSurveyTimer]);const findNextUnansweredQuestion=useCallback((responses,questionsData)=>{const answeredQuestions=new Set(responses.map(r=>r.questionId));for(let categoryIndex=0;categoryIndex<questionsData.length;categoryIndex++){const category=questionsData[categoryIndex];for(let subcategoryIndex=0;subcategoryIndex<category.subcategories.length;subcategoryIndex++){const subcategory=category.subcategories[subcategoryIndex];for(let topicIndex=0;topicIndex<subcategory.topics.length;topicIndex++){const topic=subcategory.topics[topicIndex];for(let questionIndex=0;questionIndex<topic.questions.length;questionIndex++){const questionId=\"\".concat(categoryIndex,\"-\").concat(subcategoryIndex,\"-\").concat(topicIndex,\"-\").concat(questionIndex);if(!answeredQuestions.has(questionId)){return{categoryIndex,subcategoryIndex,topicIndex,questionIndex};}}}}}if(questionsData.length>0){const lastCategory=questionsData[questionsData.length-1];const lastSubcategory=lastCategory.subcategories[lastCategory.subcategories.length-1];const lastTopic=lastSubcategory.topics[lastSubcategory.topics.length-1];return{categoryIndex:questionsData.length-1,subcategoryIndex:lastCategory.subcategories.length-1,topicIndex:lastSubcategory.topics.length-1,questionIndex:lastTopic.questions.length-1};}return{categoryIndex:0,subcategoryIndex:0,topicIndex:0,questionIndex:0};},[]);const saveResponse=useCallback(async response=>{try{console.log('FormContext: Saving response:',response);await api.saveResponse(response);dispatch({type:'ADD_RESPONSE',payload:response});dispatch({type:'SET_LAST_SAVE_TIME',payload:Date.now()});const isNewResponse=!state.responses.has(response.questionId);if(isNewResponse){const completedQuestions=state.progress.completedQuestions+1;dispatch({type:'UPDATE_PROGRESS',payload:{completedQuestions}});}}catch(error){console.error('FormContext: Error saving response:',error);dispatch({type:'SET_ERROR',payload:'Failed to save response'});throw error;}},[state.responses,state.progress.completedQuestions]);const navigateToPosition=useCallback(async(categoryIndex,subcategoryIndex,topicIndex,questionIndex)=>{const newPosition={categoryIndex,subcategoryIndex,topicIndex,questionIndex};dispatch({type:'SET_CURRENT_POSITION',payload:newPosition});if(state.sessionId){try{await api.updateUserProgress(state.sessionId,{currentCategory:categoryIndex,currentSubcategory:subcategoryIndex,currentTopic:topicIndex,currentQuestion:questionIndex});}catch(error){console.error('Failed to save navigation progress:',error);}}},[state.sessionId]);const getCurrentQuestionData=useCallback(()=>{const{categoryIndex,subcategoryIndex,topicIndex,questionIndex}=state.currentPosition;if(!state.questionsData[categoryIndex])return null;const category=state.questionsData[categoryIndex];const subcategory=category.subcategories[subcategoryIndex];const topic=subcategory===null||subcategory===void 0?void 0:subcategory.topics[topicIndex];const question=topic===null||topic===void 0?void 0:topic.questions[questionIndex];if(!question)return null;return{category:category.category,subcategory:subcategory.subcategory,topic:topic.topic,question,questionId:\"\".concat(categoryIndex,\"-\").concat(subcategoryIndex,\"-\").concat(topicIndex,\"-\").concat(questionIndex)};},[state.currentPosition,state.questionsData]);const getCurrentQuestion=useCallback(()=>{const data=getCurrentQuestionData();return(data===null||data===void 0?void 0:data.question)||null;},[getCurrentQuestionData]);const navigateToNext=useCallback(async()=>{const{categoryIndex,subcategoryIndex,topicIndex,questionIndex}=state.currentPosition;const category=state.questionsData[categoryIndex];if(!category)return;const subcategory=category.subcategories[subcategoryIndex];const topic=subcategory===null||subcategory===void 0?void 0:subcategory.topics[topicIndex];if(!topic)return;let newPosition=_objectSpread({},state.currentPosition);if(questionIndex<topic.questions.length-1){newPosition.questionIndex=questionIndex+1;}else if(topicIndex<subcategory.topics.length-1){newPosition.topicIndex=topicIndex+1;newPosition.questionIndex=0;}else if(subcategoryIndex<category.subcategories.length-1){newPosition.subcategoryIndex=subcategoryIndex+1;newPosition.topicIndex=0;newPosition.questionIndex=0;}else if(categoryIndex<state.questionsData.length-1){newPosition.categoryIndex=categoryIndex+1;newPosition.subcategoryIndex=0;newPosition.topicIndex=0;newPosition.questionIndex=0;}else{dispatch({type:'SET_COMPLETED',payload:true});return;}dispatch({type:'SET_CURRENT_POSITION',payload:newPosition});if(state.sessionId){try{await api.updateUserProgress(state.sessionId,{currentCategory:newPosition.categoryIndex,currentSubcategory:newPosition.subcategoryIndex,currentTopic:newPosition.topicIndex,currentQuestion:newPosition.questionIndex});}catch(error){console.error('Failed to save progress:',error);}}},[state.currentPosition,state.questionsData,state.sessionId]);const navigateToPrevious=useCallback(async()=>{const{categoryIndex,subcategoryIndex,topicIndex,questionIndex}=state.currentPosition;let newPosition=_objectSpread({},state.currentPosition);if(questionIndex>0){newPosition.questionIndex=questionIndex-1;}else if(topicIndex>0){const prevTopic=state.questionsData[categoryIndex].subcategories[subcategoryIndex].topics[topicIndex-1];newPosition.topicIndex=topicIndex-1;newPosition.questionIndex=prevTopic.questions.length-1;}else if(subcategoryIndex>0){const prevSubcategory=state.questionsData[categoryIndex].subcategories[subcategoryIndex-1];const lastTopic=prevSubcategory.topics[prevSubcategory.topics.length-1];newPosition.subcategoryIndex=subcategoryIndex-1;newPosition.topicIndex=prevSubcategory.topics.length-1;newPosition.questionIndex=lastTopic.questions.length-1;}else if(categoryIndex>0){const prevCategory=state.questionsData[categoryIndex-1];const lastSubcategory=prevCategory.subcategories[prevCategory.subcategories.length-1];const lastTopic=lastSubcategory.topics[lastSubcategory.topics.length-1];newPosition.categoryIndex=categoryIndex-1;newPosition.subcategoryIndex=prevCategory.subcategories.length-1;newPosition.topicIndex=lastSubcategory.topics.length-1;newPosition.questionIndex=lastTopic.questions.length-1;}dispatch({type:'SET_CURRENT_POSITION',payload:newPosition});if(state.sessionId){try{await api.updateUserProgress(state.sessionId,{currentCategory:newPosition.categoryIndex,currentSubcategory:newPosition.subcategoryIndex,currentTopic:newPosition.topicIndex,currentQuestion:newPosition.questionIndex});}catch(error){console.error('Failed to save progress:',error);}}},[state.currentPosition,state.questionsData,state.sessionId]);const calculateProgress=useCallback(()=>{const totalQuestions=state.progress.totalQuestions;const completedQuestions=state.responses.size;return totalQuestions>0?completedQuestions/totalQuestions*100:0;},[state.progress.totalQuestions,state.responses.size]);const getTotalQuestionsInCurrentTopic=useCallback(()=>{var _state$questionsData$,_state$questionsData$2;const{categoryIndex,subcategoryIndex,topicIndex}=state.currentPosition;const topic=(_state$questionsData$=state.questionsData[categoryIndex])===null||_state$questionsData$===void 0?void 0:(_state$questionsData$2=_state$questionsData$.subcategories[subcategoryIndex])===null||_state$questionsData$2===void 0?void 0:_state$questionsData$2.topics[topicIndex];return(topic===null||topic===void 0?void 0:topic.questions.length)||0;},[state.currentPosition,state.questionsData]);const getCompletedQuestionsInCurrentTopic=useCallback(()=>{var _state$questionsData$3,_state$questionsData$4;const{categoryIndex,subcategoryIndex,topicIndex}=state.currentPosition;let completed=0;const topic=(_state$questionsData$3=state.questionsData[categoryIndex])===null||_state$questionsData$3===void 0?void 0:(_state$questionsData$4=_state$questionsData$3.subcategories[subcategoryIndex])===null||_state$questionsData$4===void 0?void 0:_state$questionsData$4.topics[topicIndex];if(!topic)return 0;topic.questions.forEach((_,questionIndex)=>{const questionId=\"\".concat(categoryIndex,\"-\").concat(subcategoryIndex,\"-\").concat(topicIndex,\"-\").concat(questionIndex);if(state.responses.has(questionId)){completed++;}});return completed;},[state.currentPosition,state.questionsData,state.responses]);// FIXED: Reset session function\nconst resetSession=useCallback(()=>{localStorage.removeItem('culturalSurveySessionId');localStorage.removeItem('culturalSurveyStartTime');if(timerInterval){clearInterval(timerInterval);setTimerInterval(null);}surveyStartTimeRef.current=0;// Reset the ref\ndispatch({type:'RESET_FORM'});},[timerInterval]);const value={state,dispatch,createUserSession,saveResponse,navigateToNext,navigateToPrevious,calculateProgress,getCurrentQuestion,getCurrentQuestionData,getTotalQuestionsInCurrentTopic,getCompletedQuestionsInCurrentTopic,loadUserSession,navigateToPosition,resetSession,startSurveyTimer,formatTimeRemaining};return/*#__PURE__*/_jsx(FormContext.Provider,{value:value,children:children});}export function useForm(){const context=useContext(FormContext);if(context===undefined){throw new Error('useForm must be used within a FormProvider');}return context;}","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","useCallback","useRef","useState","loadQuestionsData","api","jsx","_jsx","SURVEY_TIME_LIMIT","WARNING_TIME_REMAINING","CRITICAL_TIME_REMAINING","initialState","sessionId","userInfo","currentPosition","categoryIndex","subcategoryIndex","topicIndex","questionIndex","responses","Map","progress","currentCategory","currentSubcategory","currentTopic","currentQuestion","completedQuestions","totalQuestions","completedTopics","attentionChecksPassed","attentionChecksFailed","isLoading","error","questionsData","startTime","lastSaveTime","isCompleted","surveyStartTime","surveyTimeLimit","surveyTimeRemaining","showTimeWarning","showTimeCritical","surveyExpired","formReducer","state","action","type","_objectSpread","payload","newResponses","set","questionId","responseMap","forEach","response","Date","now","timeRemaining","showWarning","showCritical","FormContext","undefined","FormProvider","_ref","children","dispatch","hasLoadedQuestions","isLoadingSession","timerInterval","setTimerInterval","surveyStartTimeRef","current","loadData","console","log","data","length","getTotalQuestions","reduce","total","category","subcategories","subTotal","subcategory","topics","topicTotal","topic","questions","completeExpiredSurvey","completeUser","startSurveyTimer","toISOString","clearInterval","interval","setInterval","elapsed","remaining","Math","max","floor","resumeSurveyTimer","formatTimeRemaining","milliseconds","totalSeconds","minutes","seconds","concat","toString","padStart","createUserSession","createUser","localStorage","setItem","loadUserSession","user","getUser","getUserResponses","updatedProgress","nextPosition","findNextUnansweredQuestion","savedStartTime","getItem","parseInt","answeredQuestions","Set","map","r","has","lastCategory","lastSubcategory","lastTopic","saveResponse","isNewResponse","navigateToPosition","newPosition","updateUserProgress","getCurrentQuestionData","question","getCurrentQuestion","navigateToNext","navigateToPrevious","prevTopic","prevSubcategory","prevCategory","calculateProgress","size","getTotalQuestionsInCurrentTopic","_state$questionsData$","_state$questionsData$2","getCompletedQuestionsInCurrentTopic","_state$questionsData$3","_state$questionsData$4","completed","_","resetSession","removeItem","value","Provider","useForm","context","Error"],"sources":["C:/Users/sangm/OneDrive - Brock University/CommonsenseForm/client/src/context/FormContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect, ReactNode, useCallback, useRef, useState } from 'react';\r\nimport { FormState, UserInfo, QuestionResponse, Category, Progress } from '../types/index.ts';\r\nimport { loadQuestionsData } from '../utils/helpers.ts';\r\nimport * as api from '../services/api.ts';\r\n\r\n// Timer constants\r\nconst SURVEY_TIME_LIMIT = 1 * 60 * 1000; // 15 minutes in milliseconds\r\nconst WARNING_TIME_REMAINING = 2 * 60 * 1000; // Show warning at 2 minutes remaining\r\nconst CRITICAL_TIME_REMAINING = 30 * 1000; // Show critical warning at 30 seconds\r\n\r\ntype FormAction =\r\n  | { type: 'SET_LOADING'; payload: boolean }\r\n  | { type: 'SET_ERROR'; payload: string | null }\r\n  | { type: 'SET_SESSION_ID'; payload: string }\r\n  | { type: 'SET_USER_INFO'; payload: UserInfo }\r\n  | { type: 'SET_QUESTIONS_DATA'; payload: Category[] }\r\n  | { type: 'SET_CURRENT_POSITION'; payload: { categoryIndex: number; subcategoryIndex: number; topicIndex: number; questionIndex: number } }\r\n  | { type: 'ADD_RESPONSE'; payload: QuestionResponse }\r\n  | { type: 'UPDATE_PROGRESS'; payload: Partial<Progress> }\r\n  | { type: 'SET_RESPONSES'; payload: QuestionResponse[] }\r\n  | { type: 'SET_START_TIME'; payload: number }\r\n  | { type: 'SET_LAST_SAVE_TIME'; payload: number }\r\n  | { type: 'SET_COMPLETED'; payload: boolean }\r\n  | { type: 'RESET_FORM' }\r\n  // Timer actions\r\n  | { type: 'START_SURVEY_TIMER' }\r\n  | { type: 'UPDATE_TIMER'; payload: { timeRemaining: number; showWarning: boolean; showCritical: boolean } }\r\n  | { type: 'EXPIRE_SURVEY' };\r\n\r\nconst initialState: FormState = {\r\n  sessionId: null,\r\n  userInfo: null,\r\n  currentPosition: {\r\n    categoryIndex: 0,\r\n    subcategoryIndex: 0,\r\n    topicIndex: 0,\r\n    questionIndex: 0\r\n  },\r\n  responses: new Map(),\r\n  progress: {\r\n    currentCategory: 0,\r\n    currentSubcategory: 0,\r\n    currentTopic: 0,\r\n    currentQuestion: 0,\r\n    completedQuestions: 0,\r\n    totalQuestions: 0,\r\n    completedTopics: [],\r\n    attentionChecksPassed: 0,\r\n    attentionChecksFailed: 0\r\n  },\r\n  isLoading: false,\r\n  error: null,\r\n  questionsData: [],\r\n  startTime: 0,\r\n  lastSaveTime: 0,\r\n  isCompleted: false,\r\n  // Timer state\r\n  surveyStartTime: 0,\r\n  surveyTimeLimit: SURVEY_TIME_LIMIT,\r\n  surveyTimeRemaining: SURVEY_TIME_LIMIT,\r\n  showTimeWarning: false,\r\n  showTimeCritical: false,\r\n  surveyExpired: false\r\n};\r\n\r\nfunction formReducer(state: FormState, action: FormAction): FormState {\r\n  switch (action.type) {\r\n    case 'SET_LOADING':\r\n      return { ...state, isLoading: action.payload };\r\n    case 'SET_ERROR':\r\n      return { ...state, error: action.payload };\r\n    case 'SET_SESSION_ID':\r\n      return { ...state, sessionId: action.payload };\r\n    case 'SET_USER_INFO':\r\n      return { ...state, userInfo: action.payload };\r\n    case 'SET_QUESTIONS_DATA':\r\n      return { ...state, questionsData: action.payload };\r\n    case 'SET_CURRENT_POSITION':\r\n      return { ...state, currentPosition: action.payload };\r\n    case 'ADD_RESPONSE':\r\n      const newResponses = new Map(state.responses);\r\n      newResponses.set(action.payload.questionId, action.payload);\r\n      return { ...state, responses: newResponses };\r\n    case 'UPDATE_PROGRESS':\r\n      return { \r\n        ...state, \r\n        progress: { ...state.progress, ...action.payload }\r\n      };\r\n    case 'SET_RESPONSES':\r\n      const responseMap = new Map();\r\n      action.payload.forEach(response => {\r\n        responseMap.set(response.questionId, response);\r\n      });\r\n      return { ...state, responses: responseMap };\r\n    case 'SET_START_TIME':\r\n      return { ...state, startTime: action.payload };\r\n    case 'SET_LAST_SAVE_TIME':\r\n      return { ...state, lastSaveTime: action.payload };\r\n    case 'SET_COMPLETED':\r\n      return { ...state, isCompleted: action.payload };\r\n    case 'RESET_FORM':\r\n      return { ...initialState, questionsData: state.questionsData };\r\n    // Timer cases\r\n    case 'START_SURVEY_TIMER':\r\n      return {\r\n        ...state,\r\n        surveyStartTime: Date.now(),\r\n        surveyTimeRemaining: state.surveyTimeLimit,\r\n        showTimeWarning: false,\r\n        showTimeCritical: false,\r\n        surveyExpired: false\r\n      };\r\n    case 'UPDATE_TIMER':\r\n      return {\r\n        ...state,\r\n        surveyTimeRemaining: action.payload.timeRemaining,\r\n        showTimeWarning: action.payload.showWarning,\r\n        showTimeCritical: action.payload.showCritical\r\n      };\r\n    case 'EXPIRE_SURVEY':\r\n      return {\r\n        ...state,\r\n        surveyExpired: true,\r\n        surveyTimeRemaining: 0,\r\n        isCompleted: true\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\n// Updated interface\r\ninterface FormContextType {\r\n  state: FormState;\r\n  dispatch: React.Dispatch<FormAction>;\r\n  createUserSession: (userInfo: UserInfo) => Promise<void>;\r\n  saveResponse: (response: QuestionResponse) => Promise<void>;\r\n  navigateToNext: () => void;\r\n  navigateToPrevious: () => void;\r\n  calculateProgress: () => number;\r\n  getCurrentQuestion: () => string | null;\r\n  getCurrentQuestionData: () => {\r\n    category: string;\r\n    subcategory: string;\r\n    topic: string;\r\n    question: string;\r\n    questionId: string;\r\n  } | null;\r\n  getTotalQuestionsInCurrentTopic: () => number;\r\n  getCompletedQuestionsInCurrentTopic: () => number;\r\n  loadUserSession: (sessionId: string) => Promise<void>;\r\n  navigateToPosition: (categoryIndex: number, subcategoryIndex: number, topicIndex: number, questionIndex: number) => Promise<void>;\r\n  resetSession: () => void;\r\n  // Timer functions\r\n  startSurveyTimer: () => void;\r\n  formatTimeRemaining: (milliseconds: number) => string;\r\n}\r\n\r\nconst FormContext = createContext<FormContextType | undefined>(undefined);\r\n\r\nexport function FormProvider({ children }: { children: ReactNode }) {\r\n  const [state, dispatch] = useReducer(formReducer, initialState);\r\n  const hasLoadedQuestions = useRef(false);\r\n  const isLoadingSession = useRef(false);\r\n  const [timerInterval, setTimerInterval] = useState<ReturnType<typeof setInterval> | null>(null);\r\n  const surveyStartTimeRef = useRef<number>(0); // Add this ref to track start time\r\n\r\n\r\n  // Load questions data only once\r\n  useEffect(() => {\r\n    if (hasLoadedQuestions.current) return;\r\n    \r\n    const loadData = async () => {\r\n      try {\r\n        hasLoadedQuestions.current = true;\r\n        dispatch({ type: 'SET_LOADING', payload: true });\r\n        dispatch({ type: 'SET_ERROR', payload: null });\r\n        \r\n        console.log('FormContext: Loading questions data...');\r\n        const data = await loadQuestionsData();\r\n        console.log('FormContext: Questions loaded:', data.length, 'categories');\r\n        \r\n        dispatch({ type: 'SET_QUESTIONS_DATA', payload: data });\r\n        \r\n        const totalQuestions = getTotalQuestions(data);\r\n        console.log('FormContext: Total questions calculated:', totalQuestions);\r\n        \r\n        dispatch({ type: 'UPDATE_PROGRESS', payload: { totalQuestions } });\r\n        \r\n      } catch (error) {\r\n        console.error('FormContext: Error loading questions:', error);\r\n        dispatch({ type: 'SET_ERROR', payload: 'Failed to load questions data. Please refresh the page.' });\r\n        hasLoadedQuestions.current = false;\r\n      } finally {\r\n        dispatch({ type: 'SET_LOADING', payload: false });\r\n      }\r\n    };\r\n\r\n    loadData();\r\n  }, []);\r\n\r\n  // Calculate total questions\r\n  const getTotalQuestions = (questionsData: Category[]): number => {\r\n    return questionsData.reduce((total, category) => {\r\n      return total + category.subcategories.reduce((subTotal, subcategory) => {\r\n        return subTotal + subcategory.topics.reduce((topicTotal, topic) => {\r\n          return topicTotal + topic.questions.length;\r\n        }, 0);\r\n      }, 0);\r\n    }, 0);\r\n  };\r\n\r\n  // Auto-complete survey when time expires\r\n  const completeExpiredSurvey = useCallback(async () => {\r\n    if (state.sessionId) {\r\n      try {\r\n        console.log('Survey time expired, auto-completing...');\r\n        await api.completeUser(state.sessionId);\r\n        dispatch({ type: 'SET_COMPLETED', payload: true });\r\n      } catch (error) {\r\n        console.error('Error auto-completing expired survey:', error);\r\n      }\r\n    }\r\n  }, [state.sessionId]);\r\n  // FIXED: Start timer function\r\n  const startSurveyTimer = useCallback(() => {\r\n    const startTime = Date.now();\r\n    console.log('Starting survey timer at:', new Date(startTime).toISOString());\r\n    \r\n    // Update both state and ref\r\n    dispatch({ type: 'START_SURVEY_TIMER' });\r\n    surveyStartTimeRef.current = startTime;\r\n    \r\n    // Clear any existing timer\r\n    if (timerInterval) {\r\n      clearInterval(timerInterval);\r\n    }\r\n\r\n    // Start new timer using the ref value\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      const elapsed = now - surveyStartTimeRef.current; // Use ref instead of state\r\n      const remaining = Math.max(0, SURVEY_TIME_LIMIT - elapsed);\r\n      \r\n      console.log('Timer update:', {\r\n        elapsed: Math.floor(elapsed / 1000) + 's',\r\n        remaining: Math.floor(remaining / 1000) + 's'\r\n      });\r\n      \r\n      const showWarning = remaining <= WARNING_TIME_REMAINING && remaining > CRITICAL_TIME_REMAINING;\r\n      const showCritical = remaining <= CRITICAL_TIME_REMAINING && remaining > 0;\r\n      \r\n      if (remaining <= 0) {\r\n        console.log('Timer expired!');\r\n        dispatch({ type: 'EXPIRE_SURVEY' });\r\n        clearInterval(interval);\r\n        setTimerInterval(null);\r\n        completeExpiredSurvey();\r\n      } else {\r\n        dispatch({ \r\n          type: 'UPDATE_TIMER', \r\n          payload: { \r\n            timeRemaining: remaining, \r\n            showWarning, \r\n            showCritical \r\n          } \r\n        });\r\n      }\r\n    }, 1000); // Update every second\r\n\r\n    setTimerInterval(interval);\r\n  }, [timerInterval, completeExpiredSurvey]);\r\n\r\n  // FIXED: Resume timer function\r\n  const resumeSurveyTimer = useCallback((startTime: number) => {\r\n    console.log('Resuming survey timer from:', new Date(startTime).toISOString());\r\n    const now = Date.now();\r\n    const elapsed = now - startTime;\r\n    const remaining = Math.max(0, SURVEY_TIME_LIMIT - elapsed);\r\n    \r\n    console.log('Resume timer:', {\r\n      startTime: new Date(startTime).toISOString(),\r\n      elapsed: Math.floor(elapsed / 1000) + 's',\r\n      remaining: Math.floor(remaining / 1000) + 's'\r\n    });\r\n    \r\n    if (remaining <= 0) {\r\n      console.log('Survey already expired on resume');\r\n      dispatch({ type: 'EXPIRE_SURVEY' });\r\n      completeExpiredSurvey();\r\n      return;\r\n    }\r\n\r\n    // Set the ref to the original start time\r\n    surveyStartTimeRef.current = startTime;\r\n\r\n    // Update state\r\n    dispatch({\r\n      type: 'UPDATE_TIMER',\r\n      payload: {\r\n        timeRemaining: remaining,\r\n        showWarning: remaining <= WARNING_TIME_REMAINING,\r\n        showCritical: remaining <= CRITICAL_TIME_REMAINING\r\n      }\r\n    });\r\n\r\n    // Clear any existing timer\r\n    if (timerInterval) {\r\n      clearInterval(timerInterval);\r\n    }\r\n\r\n    // Start timer with correct start time\r\n    const interval = setInterval(() => {\r\n      const now = Date.now();\r\n      const elapsed = now - surveyStartTimeRef.current; // Use the original start time\r\n      const remaining = Math.max(0, SURVEY_TIME_LIMIT - elapsed);\r\n      \r\n      const showWarning = remaining <= WARNING_TIME_REMAINING && remaining > CRITICAL_TIME_REMAINING;\r\n      const showCritical = remaining <= CRITICAL_TIME_REMAINING && remaining > 0;\r\n      \r\n      if (remaining <= 0) {\r\n        dispatch({ type: 'EXPIRE_SURVEY' });\r\n        clearInterval(interval);\r\n        setTimerInterval(null);\r\n        completeExpiredSurvey();\r\n      } else {\r\n        dispatch({ \r\n          type: 'UPDATE_TIMER', \r\n          payload: { \r\n            timeRemaining: remaining, \r\n            showWarning, \r\n            showCritical \r\n          } \r\n        });\r\n      }\r\n    }, 1000);\r\n\r\n    setTimerInterval(interval);\r\n  }, [timerInterval, completeExpiredSurvey]);\r\n\r\n  // Clean up timer on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (timerInterval) {\r\n        clearInterval(timerInterval);\r\n      }\r\n    };\r\n  }, [timerInterval]);\r\n\r\n  // FIXED: Format time function\r\n  const formatTimeRemaining = useCallback((milliseconds: number): string => {\r\n    const totalSeconds = Math.max(0, Math.floor(milliseconds / 1000));\r\n    const minutes = Math.floor(totalSeconds / 60);\r\n    const seconds = totalSeconds % 60;\r\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n  }, []);\r\n\r\n  // FIXED: Create user session\r\n  const createUserSession = useCallback(async (userInfo: UserInfo) => {\r\n    try {\r\n      dispatch({ type: 'SET_LOADING', payload: true });\r\n      const response = await api.createUser(userInfo);\r\n      dispatch({ type: 'SET_SESSION_ID', payload: response.sessionId });\r\n      dispatch({ type: 'SET_USER_INFO', payload: userInfo });\r\n      \r\n      const startTime = Date.now();\r\n      dispatch({ type: 'SET_START_TIME', payload: startTime });\r\n      \r\n      // Store session ID and start time in localStorage\r\n      localStorage.setItem('culturalSurveySessionId', response.sessionId);\r\n      localStorage.setItem('culturalSurveyStartTime', startTime.toString());\r\n      \r\n      // Start the survey timer\r\n      console.log('Creating user session and starting timer');\r\n      startSurveyTimer();\r\n      \r\n    } catch (error) {\r\n      dispatch({ type: 'SET_ERROR', payload: 'Failed to create user session' });\r\n      throw error;\r\n    } finally {\r\n      dispatch({ type: 'SET_LOADING', payload: false });\r\n    }\r\n  }, [startSurveyTimer]);\r\n\r\n  const loadUserSession = useCallback(async (sessionId: string) => {\r\n    if (isLoadingSession.current) return;\r\n    \r\n    try {\r\n      isLoadingSession.current = true;\r\n      dispatch({ type: 'SET_LOADING', payload: true });\r\n      \r\n      console.log('FormContext: Loading user session...');\r\n      const user = await api.getUser(sessionId);\r\n      \r\n      dispatch({ type: 'SET_SESSION_ID', payload: sessionId });\r\n      dispatch({ type: 'SET_USER_INFO', payload: user.userInfo });\r\n      dispatch({ type: 'SET_COMPLETED', payload: user.isCompleted });\r\n      \r\n      // Load responses\r\n      console.log('FormContext: Loading user responses...');\r\n      const responses = await api.getUserResponses(sessionId);\r\n      console.log('FormContext: Responses loaded:', responses.length);\r\n      \r\n      dispatch({ type: 'SET_RESPONSES', payload: responses });\r\n      \r\n      // Recalculate total questions from current data\r\n      const totalQuestions = getTotalQuestions(state.questionsData);\r\n      \r\n      const updatedProgress = {\r\n        ...user.progress,\r\n        totalQuestions,\r\n        completedQuestions: responses.length\r\n      };\r\n      \r\n      dispatch({ type: 'UPDATE_PROGRESS', payload: updatedProgress });\r\n      \r\n      // Find the correct starting position\r\n      const nextPosition = findNextUnansweredQuestion(responses, state.questionsData);\r\n      console.log('FormContext: Setting position to:', nextPosition);\r\n      \r\n      dispatch({ type: 'SET_CURRENT_POSITION', payload: nextPosition });\r\n      \r\n      // Resume timer if not completed\r\n      if (!user.isCompleted) {\r\n        const savedStartTime = localStorage.getItem('culturalSurveyStartTime');\r\n        if (savedStartTime) {\r\n          resumeSurveyTimer(parseInt(savedStartTime));\r\n        } else {\r\n          // If no start time found, start fresh timer\r\n          localStorage.setItem('culturalSurveyStartTime', Date.now().toString());\r\n          startSurveyTimer();\r\n        }\r\n      }\r\n      \r\n    } catch (error) {\r\n      dispatch({ type: 'SET_ERROR', payload: 'Failed to load user session' });\r\n      throw error;\r\n    } finally {\r\n      dispatch({ type: 'SET_LOADING', payload: false });\r\n      isLoadingSession.current = false;\r\n    }\r\n  }, [state.questionsData, resumeSurveyTimer, startSurveyTimer]);\r\n\r\n  const findNextUnansweredQuestion = useCallback((responses: QuestionResponse[], questionsData: Category[]) => {\r\n    const answeredQuestions = new Set(responses.map(r => r.questionId));\r\n    \r\n    for (let categoryIndex = 0; categoryIndex < questionsData.length; categoryIndex++) {\r\n      const category = questionsData[categoryIndex];\r\n      \r\n      for (let subcategoryIndex = 0; subcategoryIndex < category.subcategories.length; subcategoryIndex++) {\r\n        const subcategory = category.subcategories[subcategoryIndex];\r\n        \r\n        for (let topicIndex = 0; topicIndex < subcategory.topics.length; topicIndex++) {\r\n          const topic = subcategory.topics[topicIndex];\r\n          \r\n          for (let questionIndex = 0; questionIndex < topic.questions.length; questionIndex++) {\r\n            const questionId = `${categoryIndex}-${subcategoryIndex}-${topicIndex}-${questionIndex}`;\r\n            \r\n            if (!answeredQuestions.has(questionId)) {\r\n              return {\r\n                categoryIndex,\r\n                subcategoryIndex,\r\n                topicIndex,\r\n                questionIndex\r\n              };\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    \r\n    if (questionsData.length > 0) {\r\n      const lastCategory = questionsData[questionsData.length - 1];\r\n      const lastSubcategory = lastCategory.subcategories[lastCategory.subcategories.length - 1];\r\n      const lastTopic = lastSubcategory.topics[lastSubcategory.topics.length - 1];\r\n      \r\n      return {\r\n        categoryIndex: questionsData.length - 1,\r\n        subcategoryIndex: lastCategory.subcategories.length - 1,\r\n        topicIndex: lastSubcategory.topics.length - 1,\r\n        questionIndex: lastTopic.questions.length - 1\r\n      };\r\n    }\r\n    \r\n    return { categoryIndex: 0, subcategoryIndex: 0, topicIndex: 0, questionIndex: 0 };\r\n  }, []);\r\n\r\n  const saveResponse = useCallback(async (response: QuestionResponse) => {\r\n    try {\r\n      console.log('FormContext: Saving response:', response);\r\n      await api.saveResponse(response);\r\n      dispatch({ type: 'ADD_RESPONSE', payload: response });\r\n      dispatch({ type: 'SET_LAST_SAVE_TIME', payload: Date.now() });\r\n      \r\n      const isNewResponse = !state.responses.has(response.questionId);\r\n      if (isNewResponse) {\r\n        const completedQuestions = state.progress.completedQuestions + 1;\r\n        dispatch({ type: 'UPDATE_PROGRESS', payload: { completedQuestions } });\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.error('FormContext: Error saving response:', error);\r\n      dispatch({ type: 'SET_ERROR', payload: 'Failed to save response' });\r\n      throw error;\r\n    }\r\n  }, [state.responses, state.progress.completedQuestions]);\r\n\r\n  const navigateToPosition = useCallback(async (categoryIndex: number, subcategoryIndex: number, topicIndex: number, questionIndex: number) => {\r\n    const newPosition = { categoryIndex, subcategoryIndex, topicIndex, questionIndex };\r\n    dispatch({ type: 'SET_CURRENT_POSITION', payload: newPosition });\r\n\r\n    if (state.sessionId) {\r\n      try {\r\n        await api.updateUserProgress(state.sessionId, {\r\n          currentCategory: categoryIndex,\r\n          currentSubcategory: subcategoryIndex,\r\n          currentTopic: topicIndex,\r\n          currentQuestion: questionIndex\r\n        });\r\n      } catch (error) {\r\n        console.error('Failed to save navigation progress:', error);\r\n      }\r\n    }\r\n  }, [state.sessionId]);\r\n\r\n  const getCurrentQuestionData = useCallback(() => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex, questionIndex } = state.currentPosition;\r\n    \r\n    if (!state.questionsData[categoryIndex]) return null;\r\n    \r\n    const category = state.questionsData[categoryIndex];\r\n    const subcategory = category.subcategories[subcategoryIndex];\r\n    const topic = subcategory?.topics[topicIndex];\r\n    const question = topic?.questions[questionIndex];\r\n    \r\n    if (!question) return null;\r\n    \r\n    return {\r\n      category: category.category,\r\n      subcategory: subcategory.subcategory,\r\n      topic: topic.topic,\r\n      question,\r\n      questionId: `${categoryIndex}-${subcategoryIndex}-${topicIndex}-${questionIndex}`\r\n    };\r\n  }, [state.currentPosition, state.questionsData]);\r\n\r\n  const getCurrentQuestion = useCallback(() => {\r\n    const data = getCurrentQuestionData();\r\n    return data?.question || null;\r\n  }, [getCurrentQuestionData]);\r\n\r\n  const navigateToNext = useCallback(async () => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex, questionIndex } = state.currentPosition;\r\n    const category = state.questionsData[categoryIndex];\r\n    \r\n    if (!category) return;\r\n    \r\n    const subcategory = category.subcategories[subcategoryIndex];\r\n    const topic = subcategory?.topics[topicIndex];\r\n    \r\n    if (!topic) return;\r\n\r\n    let newPosition = { ...state.currentPosition };\r\n\r\n    if (questionIndex < topic.questions.length - 1) {\r\n      newPosition.questionIndex = questionIndex + 1;\r\n    } else if (topicIndex < subcategory.topics.length - 1) {\r\n      newPosition.topicIndex = topicIndex + 1;\r\n      newPosition.questionIndex = 0;\r\n    } else if (subcategoryIndex < category.subcategories.length - 1) {\r\n      newPosition.subcategoryIndex = subcategoryIndex + 1;\r\n      newPosition.topicIndex = 0;\r\n      newPosition.questionIndex = 0;\r\n    } else if (categoryIndex < state.questionsData.length - 1) {\r\n      newPosition.categoryIndex = categoryIndex + 1;\r\n      newPosition.subcategoryIndex = 0;\r\n      newPosition.topicIndex = 0;\r\n      newPosition.questionIndex = 0;\r\n    } else {\r\n      dispatch({ type: 'SET_COMPLETED', payload: true });\r\n      return;\r\n    }\r\n\r\n    dispatch({ type: 'SET_CURRENT_POSITION', payload: newPosition });\r\n\r\n    if (state.sessionId) {\r\n      try {\r\n        await api.updateUserProgress(state.sessionId, {\r\n          currentCategory: newPosition.categoryIndex,\r\n          currentSubcategory: newPosition.subcategoryIndex,\r\n          currentTopic: newPosition.topicIndex,\r\n          currentQuestion: newPosition.questionIndex\r\n        });\r\n      } catch (error) {\r\n        console.error('Failed to save progress:', error);\r\n      }\r\n    }\r\n  }, [state.currentPosition, state.questionsData, state.sessionId]);\r\n\r\n  const navigateToPrevious = useCallback(async () => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex, questionIndex } = state.currentPosition;\r\n    \r\n    let newPosition = { ...state.currentPosition };\r\n\r\n    if (questionIndex > 0) {\r\n      newPosition.questionIndex = questionIndex - 1;\r\n    } else if (topicIndex > 0) {\r\n      const prevTopic = state.questionsData[categoryIndex].subcategories[subcategoryIndex].topics[topicIndex - 1];\r\n      newPosition.topicIndex = topicIndex - 1;\r\n      newPosition.questionIndex = prevTopic.questions.length - 1;\r\n    } else if (subcategoryIndex > 0) {\r\n      const prevSubcategory = state.questionsData[categoryIndex].subcategories[subcategoryIndex - 1];\r\n      const lastTopic = prevSubcategory.topics[prevSubcategory.topics.length - 1];\r\n      newPosition.subcategoryIndex = subcategoryIndex - 1;\r\n      newPosition.topicIndex = prevSubcategory.topics.length - 1;\r\n      newPosition.questionIndex = lastTopic.questions.length - 1;\r\n    } else if (categoryIndex > 0) {\r\n      const prevCategory = state.questionsData[categoryIndex - 1];\r\n      const lastSubcategory = prevCategory.subcategories[prevCategory.subcategories.length - 1];\r\n      const lastTopic = lastSubcategory.topics[lastSubcategory.topics.length - 1];\r\n      newPosition.categoryIndex = categoryIndex - 1;\r\n      newPosition.subcategoryIndex = prevCategory.subcategories.length - 1;\r\n      newPosition.topicIndex = lastSubcategory.topics.length - 1;\r\n      newPosition.questionIndex = lastTopic.questions.length - 1;\r\n    }\r\n\r\n    dispatch({ type: 'SET_CURRENT_POSITION', payload: newPosition });\r\n\r\n    if (state.sessionId) {\r\n      try {\r\n        await api.updateUserProgress(state.sessionId, {\r\n          currentCategory: newPosition.categoryIndex,\r\n          currentSubcategory: newPosition.subcategoryIndex,\r\n          currentTopic: newPosition.topicIndex,\r\n          currentQuestion: newPosition.questionIndex\r\n        });\r\n      } catch (error) {\r\n        console.error('Failed to save progress:', error);\r\n      }\r\n    }\r\n  }, [state.currentPosition, state.questionsData, state.sessionId]);\r\n\r\n  const calculateProgress = useCallback(() => {\r\n    const totalQuestions = state.progress.totalQuestions;\r\n    const completedQuestions = state.responses.size;\r\n    return totalQuestions > 0 ? (completedQuestions / totalQuestions) * 100 : 0;\r\n  }, [state.progress.totalQuestions, state.responses.size]);\r\n\r\n  const getTotalQuestionsInCurrentTopic = useCallback(() => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex } = state.currentPosition;\r\n    const topic = state.questionsData[categoryIndex]?.subcategories[subcategoryIndex]?.topics[topicIndex];\r\n    return topic?.questions.length || 0;\r\n  }, [state.currentPosition, state.questionsData]);\r\n\r\n  const getCompletedQuestionsInCurrentTopic = useCallback(() => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex } = state.currentPosition;\r\n    let completed = 0;\r\n    \r\n    const topic = state.questionsData[categoryIndex]?.subcategories[subcategoryIndex]?.topics[topicIndex];\r\n    if (!topic) return 0;\r\n    \r\n    topic.questions.forEach((_, questionIndex) => {\r\n      const questionId = `${categoryIndex}-${subcategoryIndex}-${topicIndex}-${questionIndex}`;\r\n      if (state.responses.has(questionId)) {\r\n        completed++;\r\n      }\r\n    });\r\n    \r\n    return completed;\r\n  }, [state.currentPosition, state.questionsData, state.responses]);\r\n\r\n  // FIXED: Reset session function\r\n  const resetSession = useCallback(() => {\r\n    localStorage.removeItem('culturalSurveySessionId');\r\n    localStorage.removeItem('culturalSurveyStartTime');\r\n    if (timerInterval) {\r\n      clearInterval(timerInterval);\r\n      setTimerInterval(null);\r\n    }\r\n    surveyStartTimeRef.current = 0; // Reset the ref\r\n    dispatch({ type: 'RESET_FORM' });\r\n  }, [timerInterval]);\r\n  \r\n  const value: FormContextType = {\r\n    state,\r\n    dispatch,\r\n    createUserSession,\r\n    saveResponse,\r\n    navigateToNext,\r\n    navigateToPrevious,\r\n    calculateProgress,\r\n    getCurrentQuestion,\r\n    getCurrentQuestionData,\r\n    getTotalQuestionsInCurrentTopic,\r\n    getCompletedQuestionsInCurrentTopic,\r\n    loadUserSession,\r\n    navigateToPosition,\r\n    resetSession,\r\n    startSurveyTimer,\r\n    formatTimeRemaining\r\n  };\r\n\r\n  return (\r\n    <FormContext.Provider value={value}>\r\n      {children}\r\n    </FormContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useForm() {\r\n  const context = useContext(FormContext);\r\n  if (context === undefined) {\r\n    throw new Error('useForm must be used within a FormProvider');\r\n  }\r\n  return context;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}