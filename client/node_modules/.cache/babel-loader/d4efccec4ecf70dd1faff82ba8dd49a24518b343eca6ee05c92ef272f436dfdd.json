{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\sangm\\\\OneDrive - Brock University\\\\CommonsenseForm\\\\client\\\\src\\\\components\\\\QuestionForm.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useForm } from '../context/FormContext.tsx';\nimport { validateAnswer, shouldShowAttentionCheck, generateAttentionCheck, analyzeResponseQuality, analyzeUserPattern, validateAttentionCheck } from '../utils/helpers.ts';\nimport ProgressBar from './ProgressBar.tsx';\nimport QualityWarningModal from './QualityWarningModel.tsx';\nimport SurveyTimer from './SurveyTimer.tsx';\nimport * as api from '../services/api.ts';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function QuestionForm() {\n  _s();\n  const {\n    state,\n    saveResponse,\n    navigateToNext,\n    navigateToPrevious,\n    getCurrentQuestionData,\n    getTotalQuestionsInCurrentTopic,\n    getCompletedQuestionsInCurrentTopic,\n    resetSession,\n    dispatch,\n    navigateToPosition\n  } = useForm();\n\n  // Basic form state\n  const [answer, setAnswer] = useState('');\n  const [errors, setErrors] = useState({});\n  const [isSaving, setIsSaving] = useState(false);\n  const [startTime, setStartTime] = useState(Date.now());\n  const [showSuccess, setShowSuccess] = useState(false);\n  const [lastQuestionId, setLastQuestionId] = useState(null);\n  const [isNavigating, setIsNavigating] = useState(false);\n  const [navigationDirection, setNavigationDirection] = useState(null);\n\n  // Attention check state\n  const [isAttentionCheck, setIsAttentionCheck] = useState(false);\n  const [attentionCheck, setAttentionCheck] = useState(null);\n  const [lastAttentionCheckAt, setLastAttentionCheckAt] = useState(-1);\n  const [attentionChecksPassed, setAttentionChecksPassed] = useState(0);\n  const [attentionChecksFailed, setAttentionChecksFailed] = useState(0);\n  const [attentionCheckFailed, setAttentionCheckFailed] = useState(false);\n\n  // Store the question data and answer before attention check (without saving to responses)\n  const [preAttentionData, setPreAttentionData] = useState(null);\n\n  // Quality tracking state\n  const [showQualityModal, setShowQualityModal] = useState(false);\n  const [qualityWarnings, setQualityWarnings] = useState([]);\n  const [lastQualityAlertAt, setLastQualityAlertAt] = useState(-1);\n  const [hasShownQualityAlert, setHasShownQualityAlert] = useState(false);\n  const [qualityCheckCount, setQualityCheckCount] = useState(0); // Track how many quality alerts shown\n  const [currentQualityIssue, setCurrentQualityIssue] = useState({\n    type: null,\n    noneRate: 0,\n    gibberishRate: 0,\n    speedRate: 0\n  });\n\n  // Celebration state\n  const [showCelebration, setShowCelebration] = useState(null);\n  const textareaRef = useRef(null);\n  const currentQuestionData = getCurrentQuestionData();\n\n  // Helper to get actual question response count\n  const getActualQuestionResponseCount = useCallback(() => {\n    return Array.from(state.responses.keys()).filter(questionId => !questionId.startsWith('ATTENTION_CHECK_')).length;\n  }, [state.responses]);\n\n  // Helper to check if we're near the end of the survey\n  const isNearSurveyEnd = useCallback(() => {\n    const completedQuestions = getActualQuestionResponseCount();\n    const totalQuestions = state.progress.totalQuestions;\n    const remainingQuestions = totalQuestions - completedQuestions;\n\n    // Consider \"near end\" if less than 10 questions remaining or more than 80% complete\n    return remainingQuestions <= 10 || completedQuestions / totalQuestions > 0.8;\n  }, [getActualQuestionResponseCount, state.progress.totalQuestions]);\n\n  // Quality check monitoring - MORE CONSERVATIVE\n  useEffect(() => {\n    // Only check quality for actual question responses, not attention checks\n    const actualResponses = Array.from(state.responses.values()).filter(response => !response.questionId.startsWith('ATTENTION_CHECK_'));\n\n    // More conservative conditions:\n    // - Need at least 8 responses (increased from 5)\n    // - Don't show if in attention check\n    // - Don't show if near survey end\n    // - Don't show if already shown 2 quality alerts\n    // - Wait at least 30 seconds between alerts (increased from 10)\n    if (actualResponses.length < 8 || isAttentionCheck || isNearSurveyEnd() || qualityCheckCount >= 2 || hasShownQualityAlert && Date.now() - lastQualityAlertAt < 30000) {\n      return;\n    }\n    console.log('Running quality analysis on', actualResponses.length, 'actual responses');\n\n    // Analyze the user's response pattern\n    const patternAnalysis = analyzeUserPattern(actualResponses);\n    console.log('Pattern analysis results:', patternAnalysis);\n\n    // More strict thresholds for showing quality modal\n    const hasStrongSuspiciousPattern = patternAnalysis.suspiciousPattern && (patternAnalysis.noneResponseRate >= 40 ||\n    // Increased from 30\n    patternAnalysis.gibberishResponseRate >= 40 ||\n    // Increased from 30\n    patternAnalysis.fastResponseRate >= 50 ||\n    // Increased from 30\n    patternAnalysis.noneResponseRate >= 25 && patternAnalysis.fastResponseRate >= 25 // Combined threshold\n    );\n    if (hasStrongSuspiciousPattern) {\n      console.log('🚨 STRONG SUSPICIOUS PATTERN DETECTED - showing quality modal');\n      setCurrentQualityIssue({\n        type: patternAnalysis.issueType,\n        noneRate: patternAnalysis.noneResponseRate,\n        gibberishRate: patternAnalysis.gibberishResponseRate,\n        speedRate: patternAnalysis.fastResponseRate\n      });\n      setQualityWarnings(patternAnalysis.warnings);\n      setShowQualityModal(true);\n      setLastQualityAlertAt(Date.now());\n      setHasShownQualityAlert(true);\n      setQualityCheckCount(prev => prev + 1);\n    }\n  }, [\n  // Only trigger every 3 responses instead of every response\n  Math.floor(getActualQuestionResponseCount() / 3), isAttentionCheck, isNearSurveyEnd(), qualityCheckCount]);\n\n  // Separate effect to trigger attention check when navigating to a new question\n  useEffect(() => {\n    // Only run this when we have a valid question and we're not already in an attention check\n    if (!currentQuestionData || isAttentionCheck || preAttentionData) {\n      return;\n    }\n    const actualQuestionResponses = getActualQuestionResponseCount();\n    console.log('🔍 Checking for attention check trigger:', {\n      actualQuestionResponses,\n      shouldShow: shouldShowAttentionCheck(actualQuestionResponses),\n      lastAttentionCheckAt,\n      currentQuestionId: currentQuestionData.questionId\n    });\n\n    // Check if we should show attention check\n    if (shouldShowAttentionCheck(actualQuestionResponses) && actualQuestionResponses !== lastAttentionCheckAt) {\n      console.log('🚨 TRIGGERING ATTENTION CHECK at count:', actualQuestionResponses);\n\n      // Store current state before showing attention check\n      if (answer.trim().length >= 4) {\n        setPreAttentionData({\n          questionData: currentQuestionData,\n          answer: answer.trim(),\n          startTime: startTime\n        });\n      }\n      const check = generateAttentionCheck(currentQuestionData.category, currentQuestionData.topic, state.userInfo || undefined);\n      setAttentionCheck(check);\n      setIsAttentionCheck(true);\n      setLastAttentionCheckAt(actualQuestionResponses);\n      setAnswer(''); // Clear answer for attention check\n      setStartTime(Date.now());\n    }\n  }, [currentQuestionData === null || currentQuestionData === void 0 ? void 0 : currentQuestionData.questionId,\n  // Trigger when question changes\n  getActualQuestionResponseCount(),\n  // Trigger when response count changes\n  isAttentionCheck, preAttentionData, lastAttentionCheckAt]);\n\n  // Reset form when question changes - handles both regular navigation and post-attention-check\n  useEffect(() => {\n    if (currentQuestionData && currentQuestionData.questionId !== lastQuestionId) {\n      console.log('Question changed, loading data for:', currentQuestionData.questionId);\n      setErrors({});\n      setShowSuccess(false);\n      setStartTime(Date.now());\n      setLastQuestionId(currentQuestionData.questionId);\n      setIsNavigating(false);\n      setNavigationDirection(null);\n      setQualityWarnings([]);\n      if (isAttentionCheck) {\n        // We're showing an attention check, keep answer cleared\n        setAnswer('');\n      } else {\n        // Check if this matches our pre-attention data\n        if (preAttentionData && preAttentionData.questionData.questionId === currentQuestionData.questionId) {\n          console.log('🔄 Restoring pre-attention data for:', currentQuestionData.questionId);\n          setAnswer(preAttentionData.answer);\n          setStartTime(preAttentionData.startTime);\n          // Clear preAttentionData since we're now back to the original question\n          setPreAttentionData(null);\n        } else {\n          // Normal question loading - check for existing response\n          const existingResponse = state.responses.get(currentQuestionData.questionId);\n          if (existingResponse) {\n            console.log('Found existing response:', existingResponse.answer.substring(0, 50) + '...');\n            setAnswer(existingResponse.answer);\n          } else {\n            console.log('No existing response, clearing form');\n            setAnswer('');\n          }\n        }\n      }\n    }\n  }, [currentQuestionData === null || currentQuestionData === void 0 ? void 0 : currentQuestionData.questionId, lastQuestionId, state.responses, isAttentionCheck, preAttentionData]);\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (textareaRef.current) {\n      textareaRef.current.style.height = 'auto';\n      textareaRef.current.style.height = textareaRef.current.scrollHeight + 'px';\n    }\n  }, [answer]);\n  const validateForm = () => {\n    const newErrors = {};\n    const answerValidation = validateAnswer(answer);\n    if (!answerValidation.isValid) {\n      newErrors.answer = answerValidation.message;\n    }\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n  const handleAnswerChange = e => {\n    const newValue = e.target.value;\n    setAnswer(newValue);\n    if (errors.answer) {\n      setErrors(prev => ({\n        ...prev,\n        answer: undefined\n      }));\n    }\n\n    // More conservative real-time quality feedback\n    // Only show for very obvious issues and not during attention checks\n    if (newValue.length > 10 && !isAttentionCheck && !isNearSurveyEnd()) {\n      const qualityAnalysis = analyzeResponseQuality(newValue);\n      // Only show warnings for very low quality responses (score < 20)\n      if (qualityAnalysis.isLowQuality && qualityAnalysis.score < 20) {\n        setQualityWarnings(qualityAnalysis.issues.slice(0, 2)); // Limit to 2 warnings\n      } else {\n        setQualityWarnings([]);\n      }\n    } else {\n      setQualityWarnings([]);\n    }\n  };\n  const handleClear = () => {\n    setAnswer('');\n    setErrors({});\n    setShowSuccess(false);\n    setQualityWarnings([]);\n    if (textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  };\n  const checkForMilestones = () => {\n    const {\n      categoryIndex,\n      subcategoryIndex,\n      topicIndex,\n      questionIndex\n    } = state.currentPosition;\n    const currentCategory = state.questionsData[categoryIndex];\n    const currentSubcategory = currentCategory === null || currentCategory === void 0 ? void 0 : currentCategory.subcategories[subcategoryIndex];\n    const currentTopic = currentSubcategory === null || currentSubcategory === void 0 ? void 0 : currentSubcategory.topics[topicIndex];\n    if (!currentTopic) return null;\n    if (questionIndex === currentTopic.questions.length - 1) {\n      if (topicIndex === currentSubcategory.topics.length - 1) {\n        if (subcategoryIndex === currentCategory.subcategories.length - 1) {\n          return {\n            type: 'category',\n            name: currentCategory.category,\n            subcategoryName: currentSubcategory.subcategory,\n            topicName: currentTopic.topic\n          };\n        }\n        return {\n          type: 'subcategory',\n          name: currentSubcategory.subcategory,\n          topicName: currentTopic.topic,\n          categoryName: currentCategory.category\n        };\n      }\n      return {\n        type: 'topic',\n        name: currentTopic.topic,\n        subcategoryName: currentSubcategory.subcategory,\n        categoryName: currentCategory.category\n      };\n    }\n    return null;\n  };\n\n  // UPDATED performSave to handle both regular and pre-attention data\n  const performSave = async (questionDataToUse, answerToUse, startTimeToUse, qualityAnalysis, skipSuccessMessage) => {\n    const questionData = questionDataToUse || currentQuestionData;\n    const answerText = answerToUse || answer;\n    const timeStart = startTimeToUse || startTime;\n    if (!questionData || !state.sessionId) {\n      console.error('Missing required data for save');\n      return false;\n    }\n\n    // For attention checks, create a special question ID using actual response count\n    const questionId = isAttentionCheck ? `ATTENTION_CHECK_${getActualQuestionResponseCount()}_${questionData.questionId}` : questionData.questionId;\n    const questionText = isAttentionCheck ? attentionCheck.question : questionData.question;\n    if (!qualityAnalysis) {\n      qualityAnalysis = analyzeResponseQuality(answerText);\n    }\n    setIsSaving(true);\n    try {\n      const timeSpent = Math.floor((Date.now() - timeStart) / 1000);\n      const response = {\n        sessionId: state.sessionId,\n        questionId: questionId,\n        categoryIndex: state.currentPosition.categoryIndex,\n        subcategoryIndex: state.currentPosition.subcategoryIndex,\n        topicIndex: state.currentPosition.topicIndex,\n        questionIndex: state.currentPosition.questionIndex,\n        category: questionData.category,\n        subcategory: questionData.subcategory,\n        topic: questionData.topic,\n        question: questionText,\n        answer: answerText.trim(),\n        timeSpent,\n        timestamp: new Date().toISOString(),\n        qualityScore: qualityAnalysis.score,\n        isAttentionCheck: isAttentionCheck,\n        attentionCheckType: isAttentionCheck ? attentionCheck.type : undefined,\n        expectedAnswer: isAttentionCheck ? attentionCheck.expectedAnswer : undefined\n      };\n      console.log('Saving response:', {\n        questionId,\n        isAttentionCheck,\n        answer: answerText.substring(0, 50) + '...',\n        totalResponses: state.responses.size,\n        qualityScore: qualityAnalysis.score\n      });\n      await saveResponse(response);\n\n      // Only show success message if not skipped and not an attention check\n      if (!skipSuccessMessage && !isAttentionCheck) {\n        setShowSuccess(true);\n        setTimeout(() => setShowSuccess(false), 2000);\n      }\n      return true;\n    } catch (error) {\n      console.error('SAVE ERROR:', error);\n      throw error;\n    } finally {\n      setIsSaving(false);\n    }\n  };\n  const handleSave = async () => {\n    if (!validateForm() || !currentQuestionData || !state.sessionId) {\n      console.log('Validation failed:', errors);\n      return false;\n    }\n    try {\n      const qualityAnalysis = analyzeResponseQuality(answer);\n      return await performSave(undefined, undefined, undefined, qualityAnalysis);\n    } catch (error) {\n      console.error('Save failed:', error);\n      alert('Failed to save response. Please try again.');\n      return false;\n    }\n  };\n\n  // FIXED handleNext function - REMOVED individual quality check before submit\n  const handleNext = async () => {\n    const isValid = validateForm();\n    if (!isValid) {\n      console.log('Form validation failed, cannot proceed');\n      return;\n    }\n\n    // Handle attention check validation\n    if (isAttentionCheck && attentionCheck) {\n      const expectedAnswers = attentionCheck.expectedAnswers || [attentionCheck.expectedAnswer];\n      const isAttentionCheckValid = validateAttentionCheck(answer, expectedAnswers);\n      console.log('ATTENTION CHECK VALIDATION:', {\n        userAnswer: answer,\n        expectedAnswers: expectedAnswers,\n        isValid: isAttentionCheckValid,\n        attentionCheckType: attentionCheck.type\n      });\n      if (!isAttentionCheckValid) {\n        console.log('❌ ATTENTION CHECK FAILED - Redirecting to completion');\n        try {\n          await performSave();\n          console.log('Failed attention check response saved');\n        } catch (error) {\n          console.error('Error saving failed attention check:', error);\n        }\n        if (state.sessionId) {\n          try {\n            await api.completeUser(state.sessionId, 'attention_check_failed');\n            console.log('Survey marked as completed due to attention check failure');\n          } catch (error) {\n            console.error('Error marking survey completed:', error);\n          }\n        }\n        dispatch({\n          type: 'SET_ATTENTION_CHECK_FAILED',\n          payload: true\n        });\n        return;\n      } else {\n        console.log('✅ ATTENTION CHECK PASSED');\n\n        // Save the attention check response\n        try {\n          await performSave();\n          console.log('Attention check response saved');\n        } catch (error) {\n          console.error('Error saving attention check:', error);\n        }\n\n        // Save the pre-attention data if it exists\n        if (preAttentionData) {\n          console.log('💾 Saving pre-attention data:', preAttentionData.questionData.questionId);\n          try {\n            await performSave(preAttentionData.questionData, preAttentionData.answer, preAttentionData.startTime, undefined, true // Skip success message\n            );\n            console.log('Pre-attention data saved successfully');\n          } catch (error) {\n            console.error('Error saving pre-attention data:', error);\n          }\n        }\n\n        // Reset attention check state and clear pre-attention data\n        setIsAttentionCheck(false);\n        setAttentionCheck(null);\n\n        // TRIGGER NAVIGATION with animation\n        setNavigationDirection('next');\n        setIsNavigating(true);\n        setTimeout(() => {\n          // Clear the answer field to prevent wrong answer from showing\n          setAnswer('');\n          setPreAttentionData(null);\n\n          // Force re-render by updating the question ID tracker\n          setLastQuestionId(null);\n        }, 300);\n        return;\n      }\n    }\n\n    // Regular question flow - REMOVED individual quality check before submit\n    // This prevents quality modals from showing right before submission\n    try {\n      const saveSuccessful = await handleSave();\n      if (saveSuccessful && isValid) {\n        // If we have pre-attention data and we're saving the same question, clear it\n        if (preAttentionData && currentQuestionData && preAttentionData.questionData.questionId === currentQuestionData.questionId) {\n          console.log('Clearing pre-attention data after saving the same question');\n          setPreAttentionData(null);\n        }\n        const milestone = checkForMilestones();\n        setNavigationDirection('next');\n        setIsNavigating(true);\n        setTimeout(() => {\n          navigateToNext();\n          if (milestone && !isAttentionCheck) {\n            setShowCelebration({\n              type: milestone.type,\n              data: milestone\n            });\n          }\n        }, 300);\n      }\n    } catch (error) {\n      console.error('Next navigation failed:', error);\n    }\n  };\n  const handlePrevious = () => {\n    setNavigationDirection('previous');\n    setIsNavigating(true);\n    setTimeout(() => {\n      navigateToPrevious();\n    }, 300);\n  };\n  const handleSkip = () => {\n    if (isAttentionCheck) return; // Don't allow skipping attention checks\n\n    setAnswer('');\n    setErrors({});\n    setNavigationDirection('next');\n    setIsNavigating(true);\n    setTimeout(() => {\n      navigateToNext();\n    }, 300);\n  };\n  const handleQualityModalClose = () => {\n    console.log('Quality modal closed - user will improve response');\n    setShowQualityModal(false);\n\n    // Clear the current answer to force them to rewrite\n    setAnswer('');\n    setErrors({});\n    setQualityWarnings([]);\n\n    // Reset the quality issue state\n    setCurrentQualityIssue({\n      type: null,\n      noneRate: 0,\n      gibberishRate: 0,\n      speedRate: 0\n    });\n    setTimeout(() => {\n      if (textareaRef.current) {\n        textareaRef.current.focus();\n      }\n    }, 100);\n  };\n  const closeCelebration = () => {\n    setShowCelebration(null);\n  };\n  if (!currentQuestionData) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"min-h-screen bg-gray-100 flex items-center justify-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600\",\n          children: \"Loading question...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 588,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 587,\n      columnNumber: 7\n    }, this);\n  }\n  if (state.surveyExpired) {\n    return null;\n  }\n  const isFirstQuestion = state.currentPosition.categoryIndex === 0 && state.currentPosition.subcategoryIndex === 0 && state.currentPosition.topicIndex === 0 && state.currentPosition.questionIndex === 0;\n  const isFormValid = answer.trim().length >= 4;\n  const displayQuestion = isAttentionCheck ? attentionCheck.question : currentQuestionData.question;\n  if (attentionCheckFailed) {\n    return null;\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"min-h-screen\",\n    style: {\n      background: `linear-gradient(135deg, var(--bg-primary) 0%, var(--color-cream) 50%, var(--bg-secondary) 100%)`\n    },\n    children: [/*#__PURE__*/_jsxDEV(SurveyTimer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 619,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ProgressBar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 620,\n      columnNumber: 7\n    }, this), !isAttentionCheck && /*#__PURE__*/_jsxDEV(QualityWarningModal, {\n      isOpen: showQualityModal,\n      onClose: handleQualityModalClose,\n      qualityIssues: qualityWarnings,\n      issueType: currentQualityIssue.type,\n      noneResponseRate: currentQualityIssue.noneRate,\n      gibberishResponseRate: currentQualityIssue.gibberishRate,\n      fastResponseRate: currentQualityIssue.speedRate\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 623,\n      columnNumber: 9\n    }, this), showCelebration && /*#__PURE__*/_jsxDEV(CelebrationModal, {\n      celebration: showCelebration,\n      onClose: closeCelebration\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 635,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"max-w-4xl mx-auto px-4 py-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"relative overflow-hidden\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `transform transition-all duration-500 ease-in-out ${isNavigating ? navigationDirection === 'next' ? '-translate-x-full opacity-0' : 'translate-x-full opacity-0' : 'translate-x-0 opacity-100'}`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"backdrop-blur-sm rounded-2xl shadow-lg overflow-hidden\",\n            style: {\n              backgroundColor: 'var(--bg-card)',\n              border: '1px solid var(--border-light)'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-6\",\n              style: {\n                background: 'var(--bg-card-header)',\n                color: 'var(--text-on-dark)'\n              },\n              children: [isAttentionCheck && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mb-3 text-sm font-medium\",\n                style: {\n                  color: 'var(--text-on-dark)'\n                },\n                children: \"\\uD83D\\uDD0D Attention Check\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 667,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n                className: \"text-lg md:text-xl font-medium leading-relaxed\",\n                children: displayQuestion\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 671,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 659,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"p-6\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mb-6\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex justify-between items-center mb-3\",\n                  children: [/*#__PURE__*/_jsxDEV(\"label\", {\n                    className: \"block text-base font-medium\",\n                    style: {\n                      color: 'var(--text-primary)'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                      children: \"Your Answer *\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 683,\n                      columnNumber: 23\n                    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                      className: \"block text-xs font-normal mt-1\",\n                      style: {\n                        color: 'var(--text-secondary)'\n                      },\n                      children: \"You can specify \\\"none\\\" if no answer exists\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 684,\n                      columnNumber: 23\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 679,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleClear,\n                    className: \"text-sm font-medium hover:underline transition-colors\",\n                    style: {\n                      color: 'var(--accent-warning)'\n                    },\n                    children: \"Clear Form\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 691,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 678,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"relative\",\n                  children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n                    ref: textareaRef,\n                    value: answer,\n                    onChange: handleAnswerChange,\n                    placeholder: \"Share your knowledge about cultural practices in your region, or specify 'none' if no answer exists...\",\n                    className: `w-full px-4 py-3 border-2 rounded-xl resize-none min-h-[120px] transition-all duration-200 ${errors.answer ? 'focus:border-red-400' : ''}`,\n                    style: {\n                      color: 'var(--text-primary)',\n                      borderColor: errors.answer ? 'var(--accent-error)' : 'var(--border-medium)',\n                      backgroundColor: 'rgba(244, 228, 202, 0.3)'\n                    },\n                    maxLength: 5000,\n                    disabled: isSaving\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 701,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `absolute bottom-3 right-3 px-2 py-1 rounded-lg text-xs border`,\n                    style: {\n                      backgroundColor: answer.length >= 4 ? 'var(--color-cream)' : '#fef3c7',\n                      color: answer.length >= 4 ? 'var(--text-secondary)' : 'var(--accent-warning)',\n                      borderColor: answer.length >= 4 ? 'var(--border-light)' : '#fbbf24'\n                    },\n                    children: [answer.length, \"/5000 \", answer.length < 4 && `(${4 - answer.length} more needed)`]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 718,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 700,\n                  columnNumber: 19\n                }, this), errors.answer && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm mt-2 font-medium\",\n                  style: {\n                    color: 'var(--accent-error)'\n                  },\n                  children: errors.answer\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 731,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 677,\n                columnNumber: 17\n              }, this), !isAttentionCheck && qualityWarnings.length > 0 && !isNearSurveyEnd() && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mb-4 p-3 border rounded-xl\",\n                style: {\n                  background: 'var(--btn-warning-bg)',\n                  borderColor: '#fbbf24'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-start\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: 'var(--accent-warning)'\n                    },\n                    className: \"mr-2\",\n                    children: \"\\u26A0\\uFE0F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 746,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"text-sm\",\n                    style: {\n                      color: '#92400e'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"font-medium mb-1\",\n                      children: \"Response Quality Notice:\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 748,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n                      className: \"text-xs space-y-1\",\n                      children: qualityWarnings.map((warning, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n                        children: [\"\\u2022 \", warning]\n                      }, index, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 751,\n                        columnNumber: 29\n                      }, this))\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 749,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"mt-2 font-medium\",\n                      children: \"Please provide detailed responses or specify \\\"none\\\" if not applicable.\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 754,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 747,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 745,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 738,\n                columnNumber: 19\n              }, this), showSuccess && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mb-4 p-3 border rounded-xl animate-bounce-in\",\n                style: {\n                  background: 'var(--accent-success)',\n                  borderColor: 'var(--border-dark)',\n                  color: 'var(--text-on-dark)'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-center\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"mr-2\",\n                    children: \"\\u2728\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 772,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"font-medium text-sm\",\n                    children: \"Response saved successfully!\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 773,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 771,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 763,\n                columnNumber: 19\n              }, this), !isFormValid && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"mb-4 p-3 border rounded-xl\",\n                style: {\n                  background: 'var(--btn-warning-bg)',\n                  borderColor: '#fbbf24'\n                },\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex items-start\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    style: {\n                      color: 'var(--accent-warning)'\n                    },\n                    className: \"mr-2\",\n                    children: \"\\u26A0\\uFE0F\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 787,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"text-sm\",\n                    style: {\n                      color: '#92400e'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                      className: \"font-medium mb-1\",\n                      children: \"Please complete the following:\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 789,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n                      className: \"text-xs space-y-1\",\n                      children: /*#__PURE__*/_jsxDEV(\"li\", {\n                        children: \"\\u2022 Add at least 4 characters to your answer or specify \\\"none\\\"\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 791,\n                        columnNumber: 27\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 790,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 788,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 786,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 779,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between items-center pt-4 border-t\",\n                style: {\n                  borderColor: 'var(--border-light)'\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: handlePrevious,\n                  disabled: isFirstQuestion || isNavigating || isAttentionCheck,\n                  className: \"flex items-center px-4 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\",\n                  style: {\n                    background: 'var(--btn-warning-bg)',\n                    color: '#92400e'\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"mr-2\",\n                    children: \"\\u2190\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 811,\n                    columnNumber: 21\n                  }, this), \"Previous\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 802,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex space-x-3\",\n                  children: [!isAttentionCheck && /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleSkip,\n                    disabled: isNavigating,\n                    className: \"px-4 py-2 font-medium rounded-xl transition-all duration-200 text-sm\",\n                    style: {\n                      background: 'var(--btn-warning-bg)',\n                      color: '#92400e'\n                    },\n                    children: \"Skip\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 817,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleSave,\n                    disabled: isSaving || !isFormValid || isNavigating,\n                    className: \"px-4 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\",\n                    style: {\n                      background: 'var(--btn-secondary-bg)',\n                      color: 'var(--text-on-dark)'\n                    },\n                    children: isSaving ? 'Saving...' : 'Save'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 830,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    onClick: handleNext,\n                    disabled: isSaving || !isFormValid || isNavigating,\n                    className: \"flex items-center px-5 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\",\n                    style: {\n                      background: 'var(--btn-primary-bg)',\n                      color: 'var(--text-on-dark)'\n                    },\n                    children: isNavigating ? 'Moving...' : /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [\"Save & Continue\", /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"ml-2\",\n                        children: \"\\u2192\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 854,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 842,\n                    columnNumber: 21\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 815,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 798,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 676,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 651,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 643,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 642,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 641,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 613,\n    columnNumber: 5\n  }, this);\n}\n\n// Celebration Modal Component\n_s(QuestionForm, \"rbpQ+kNTYcgL7XryXdY5jNP86Wo=\", false, function () {\n  return [useForm];\n});\n_c = QuestionForm;\nfunction CelebrationModal({\n  celebration,\n  onClose\n}) {\n  const celebrations = {\n    topic: {\n      icon: '🎯',\n      title: 'Section Completed!',\n      message: 'Great progress! Keep going!'\n    },\n    subcategory: {\n      icon: '🏆',\n      title: 'Section Mastered!',\n      message: 'Excellent work! Moving to next section!'\n    },\n    category: {\n      icon: '👑',\n      title: 'Major Section Complete!',\n      message: 'Outstanding! You\\'re making great progress!'\n    }\n  };\n  const config = celebrations[celebration.type];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"rounded-2xl p-6 max-w-lg mx-auto text-center shadow-2xl animate-bounce-in\",\n      style: {\n        backgroundColor: 'var(--bg-card)',\n        border: '1px solid var(--border-light)'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-5xl mb-3\",\n        children: config.icon\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 903,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold mb-3\",\n        style: {\n          color: 'var(--text-primary)'\n        },\n        children: config.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 904,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-lg mb-4\",\n        style: {\n          color: 'var(--text-secondary)'\n        },\n        children: config.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 910,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        className: \"px-6 py-2 font-medium rounded-xl transition-all duration-200\",\n        style: {\n          background: 'var(--btn-primary-bg)',\n          color: 'var(--text-on-dark)'\n        },\n        children: \"Continue Survey\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 916,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 896,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 895,\n    columnNumber: 5\n  }, this);\n}\n_c2 = CelebrationModal;\nvar _c, _c2;\n$RefreshReg$(_c, \"QuestionForm\");\n$RefreshReg$(_c2, \"CelebrationModal\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useForm","validateAnswer","shouldShowAttentionCheck","generateAttentionCheck","analyzeResponseQuality","analyzeUserPattern","validateAttentionCheck","ProgressBar","QualityWarningModal","SurveyTimer","api","jsxDEV","_jsxDEV","Fragment","_Fragment","QuestionForm","_s","state","saveResponse","navigateToNext","navigateToPrevious","getCurrentQuestionData","getTotalQuestionsInCurrentTopic","getCompletedQuestionsInCurrentTopic","resetSession","dispatch","navigateToPosition","answer","setAnswer","errors","setErrors","isSaving","setIsSaving","startTime","setStartTime","Date","now","showSuccess","setShowSuccess","lastQuestionId","setLastQuestionId","isNavigating","setIsNavigating","navigationDirection","setNavigationDirection","isAttentionCheck","setIsAttentionCheck","attentionCheck","setAttentionCheck","lastAttentionCheckAt","setLastAttentionCheckAt","attentionChecksPassed","setAttentionChecksPassed","attentionChecksFailed","setAttentionChecksFailed","attentionCheckFailed","setAttentionCheckFailed","preAttentionData","setPreAttentionData","showQualityModal","setShowQualityModal","qualityWarnings","setQualityWarnings","lastQualityAlertAt","setLastQualityAlertAt","hasShownQualityAlert","setHasShownQualityAlert","qualityCheckCount","setQualityCheckCount","currentQualityIssue","setCurrentQualityIssue","type","noneRate","gibberishRate","speedRate","showCelebration","setShowCelebration","textareaRef","currentQuestionData","getActualQuestionResponseCount","Array","from","responses","keys","filter","questionId","startsWith","length","isNearSurveyEnd","completedQuestions","totalQuestions","progress","remainingQuestions","actualResponses","values","response","console","log","patternAnalysis","hasStrongSuspiciousPattern","suspiciousPattern","noneResponseRate","gibberishResponseRate","fastResponseRate","issueType","warnings","prev","Math","floor","actualQuestionResponses","shouldShow","currentQuestionId","trim","questionData","check","category","topic","userInfo","undefined","existingResponse","get","substring","current","style","height","scrollHeight","validateForm","newErrors","answerValidation","isValid","message","Object","handleAnswerChange","e","newValue","target","value","qualityAnalysis","isLowQuality","score","issues","slice","handleClear","focus","checkForMilestones","categoryIndex","subcategoryIndex","topicIndex","questionIndex","currentPosition","currentCategory","questionsData","currentSubcategory","subcategories","currentTopic","topics","questions","name","subcategoryName","subcategory","topicName","categoryName","performSave","questionDataToUse","answerToUse","startTimeToUse","skipSuccessMessage","answerText","timeStart","sessionId","error","questionText","question","timeSpent","timestamp","toISOString","qualityScore","attentionCheckType","expectedAnswer","totalResponses","size","setTimeout","handleSave","alert","handleNext","expectedAnswers","isAttentionCheckValid","userAnswer","completeUser","payload","saveSuccessful","milestone","data","handlePrevious","handleSkip","handleQualityModalClose","closeCelebration","className","children","fileName","_jsxFileName","lineNumber","columnNumber","surveyExpired","isFirstQuestion","isFormValid","displayQuestion","background","isOpen","onClose","qualityIssues","CelebrationModal","celebration","backgroundColor","border","color","onClick","ref","onChange","placeholder","borderColor","maxLength","disabled","map","warning","index","_c","celebrations","icon","title","config","_c2","$RefreshReg$"],"sources":["C:/Users/sangm/OneDrive - Brock University/CommonsenseForm/client/src/components/QuestionForm.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useForm } from '../context/FormContext.tsx';\r\nimport { validateAnswer, shouldShowAttentionCheck, generateAttentionCheck, analyzeResponseQuality, analyzeUserPattern, validateAttentionCheck } from '../utils/helpers.ts';\r\nimport ProgressBar from './ProgressBar.tsx';\r\nimport QualityWarningModal from './QualityWarningModel.tsx';\r\nimport SurveyTimer from './SurveyTimer.tsx';\r\nimport TimeWarningModal from './TimeWarningModal.tsx';\r\nimport * as api from '../services/api.ts';\r\n\r\nexport default function QuestionForm() {\r\n  const {\r\n    state,\r\n    saveResponse,\r\n    navigateToNext,\r\n    navigateToPrevious,\r\n    getCurrentQuestionData,\r\n    getTotalQuestionsInCurrentTopic,\r\n    getCompletedQuestionsInCurrentTopic,\r\n    resetSession,\r\n    dispatch,\r\n    navigateToPosition\r\n  } = useForm();\r\n\r\n  // Basic form state\r\n  const [answer, setAnswer] = useState('');\r\n  const [errors, setErrors] = useState<{ answer?: string }>({});\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [startTime, setStartTime] = useState(Date.now());\r\n  const [showSuccess, setShowSuccess] = useState(false);\r\n  const [lastQuestionId, setLastQuestionId] = useState<string | null>(null);\r\n  const [isNavigating, setIsNavigating] = useState(false);\r\n  const [navigationDirection, setNavigationDirection] = useState<'next' | 'previous' | null>(null);\r\n\r\n  // Attention check state\r\n  const [isAttentionCheck, setIsAttentionCheck] = useState(false);\r\n  const [attentionCheck, setAttentionCheck] = useState<any>(null);\r\n  const [lastAttentionCheckAt, setLastAttentionCheckAt] = useState<number>(-1);\r\n  const [attentionChecksPassed, setAttentionChecksPassed] = useState(0);\r\n  const [attentionChecksFailed, setAttentionChecksFailed] = useState(0);\r\n  const [attentionCheckFailed, setAttentionCheckFailed] = useState(false);\r\n\r\n  // Store the question data and answer before attention check (without saving to responses)\r\n  const [preAttentionData, setPreAttentionData] = useState<{\r\n    questionData: any;\r\n    answer: string;\r\n    startTime: number;\r\n  } | null>(null);\r\n\r\n  // Quality tracking state\r\n  const [showQualityModal, setShowQualityModal] = useState(false);\r\n  const [qualityWarnings, setQualityWarnings] = useState<string[]>([]);\r\n  const [lastQualityAlertAt, setLastQualityAlertAt] = useState<number>(-1);\r\n  const [hasShownQualityAlert, setHasShownQualityAlert] = useState(false);\r\n  const [qualityCheckCount, setQualityCheckCount] = useState(0); // Track how many quality alerts shown\r\n  const [currentQualityIssue, setCurrentQualityIssue] = useState<{\r\n    type: string | null;\r\n    noneRate: number;\r\n    gibberishRate: number;\r\n    speedRate: number;\r\n  }>({ type: null, noneRate: 0, gibberishRate: 0, speedRate: 0 });\r\n\r\n  // Celebration state\r\n  const [showCelebration, setShowCelebration] = useState<{type: string, data: any} | null>(null);\r\n\r\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\r\n  const currentQuestionData = getCurrentQuestionData();\r\n\r\n  // Helper to get actual question response count\r\n  const getActualQuestionResponseCount = useCallback(() => {\r\n    return Array.from(state.responses.keys())\r\n      .filter(questionId => !questionId.startsWith('ATTENTION_CHECK_'))\r\n      .length;\r\n  }, [state.responses]);\r\n\r\n  // Helper to check if we're near the end of the survey\r\n  const isNearSurveyEnd = useCallback(() => {\r\n    const completedQuestions = getActualQuestionResponseCount();\r\n    const totalQuestions = state.progress.totalQuestions;\r\n    const remainingQuestions = totalQuestions - completedQuestions;\r\n    \r\n    // Consider \"near end\" if less than 10 questions remaining or more than 80% complete\r\n    return remainingQuestions <= 10 || (completedQuestions / totalQuestions) > 0.8;\r\n  }, [getActualQuestionResponseCount, state.progress.totalQuestions]);\r\n\r\n  // Quality check monitoring - MORE CONSERVATIVE\r\n  useEffect(() => {\r\n    // Only check quality for actual question responses, not attention checks\r\n    const actualResponses = Array.from(state.responses.values())\r\n      .filter(response => !response.questionId.startsWith('ATTENTION_CHECK_'));\r\n      \r\n    // More conservative conditions:\r\n    // - Need at least 8 responses (increased from 5)\r\n    // - Don't show if in attention check\r\n    // - Don't show if near survey end\r\n    // - Don't show if already shown 2 quality alerts\r\n    // - Wait at least 30 seconds between alerts (increased from 10)\r\n    if (actualResponses.length < 8 || \r\n        isAttentionCheck || \r\n        isNearSurveyEnd() || \r\n        qualityCheckCount >= 2 ||\r\n        (hasShownQualityAlert && Date.now() - lastQualityAlertAt < 30000)) {\r\n      return;\r\n    }\r\n\r\n    console.log('Running quality analysis on', actualResponses.length, 'actual responses');\r\n    \r\n    // Analyze the user's response pattern\r\n    const patternAnalysis = analyzeUserPattern(actualResponses);\r\n    \r\n    console.log('Pattern analysis results:', patternAnalysis);\r\n    \r\n    // More strict thresholds for showing quality modal\r\n    const hasStrongSuspiciousPattern = patternAnalysis.suspiciousPattern && (\r\n      patternAnalysis.noneResponseRate >= 40 || // Increased from 30\r\n      patternAnalysis.gibberishResponseRate >= 40 || // Increased from 30\r\n      patternAnalysis.fastResponseRate >= 50 || // Increased from 30\r\n      (patternAnalysis.noneResponseRate >= 25 && patternAnalysis.fastResponseRate >= 25) // Combined threshold\r\n    );\r\n    \r\n    if (hasStrongSuspiciousPattern) {\r\n      console.log('🚨 STRONG SUSPICIOUS PATTERN DETECTED - showing quality modal');\r\n      \r\n      setCurrentQualityIssue({\r\n        type: patternAnalysis.issueType,\r\n        noneRate: patternAnalysis.noneResponseRate,\r\n        gibberishRate: patternAnalysis.gibberishResponseRate,\r\n        speedRate: patternAnalysis.fastResponseRate\r\n      });\r\n      \r\n      setQualityWarnings(patternAnalysis.warnings);\r\n      setShowQualityModal(true);\r\n      setLastQualityAlertAt(Date.now());\r\n      setHasShownQualityAlert(true);\r\n      setQualityCheckCount(prev => prev + 1);\r\n    }\r\n  }, [\r\n    // Only trigger every 3 responses instead of every response\r\n    Math.floor(getActualQuestionResponseCount() / 3),\r\n    isAttentionCheck,\r\n    isNearSurveyEnd(),\r\n    qualityCheckCount\r\n  ]);\r\n\r\n  // Separate effect to trigger attention check when navigating to a new question\r\n  useEffect(() => {\r\n    // Only run this when we have a valid question and we're not already in an attention check\r\n    if (!currentQuestionData || isAttentionCheck || preAttentionData) {\r\n      return;\r\n    }\r\n\r\n    const actualQuestionResponses = getActualQuestionResponseCount();\r\n    \r\n    console.log('🔍 Checking for attention check trigger:', {\r\n      actualQuestionResponses,\r\n      shouldShow: shouldShowAttentionCheck(actualQuestionResponses),\r\n      lastAttentionCheckAt,\r\n      currentQuestionId: currentQuestionData.questionId\r\n    });\r\n\r\n    // Check if we should show attention check\r\n    if (shouldShowAttentionCheck(actualQuestionResponses) && actualQuestionResponses !== lastAttentionCheckAt) {\r\n      console.log('🚨 TRIGGERING ATTENTION CHECK at count:', actualQuestionResponses);\r\n      \r\n      // Store current state before showing attention check\r\n      if (answer.trim().length >= 4) {\r\n        setPreAttentionData({\r\n          questionData: currentQuestionData,\r\n          answer: answer.trim(),\r\n          startTime: startTime\r\n        });\r\n      }\r\n      \r\n      const check = generateAttentionCheck(\r\n        currentQuestionData.category,\r\n        currentQuestionData.topic,\r\n        state.userInfo || undefined\r\n      );\r\n      \r\n      setAttentionCheck(check);\r\n      setIsAttentionCheck(true);\r\n      setLastAttentionCheckAt(actualQuestionResponses);\r\n      setAnswer(''); // Clear answer for attention check\r\n      setStartTime(Date.now());\r\n    }\r\n  }, [\r\n    currentQuestionData?.questionId, // Trigger when question changes\r\n    getActualQuestionResponseCount(), // Trigger when response count changes\r\n    isAttentionCheck,\r\n    preAttentionData,\r\n    lastAttentionCheckAt\r\n  ]);\r\n\r\n  // Reset form when question changes - handles both regular navigation and post-attention-check\r\n  useEffect(() => {\r\n    if (currentQuestionData && currentQuestionData.questionId !== lastQuestionId) {\r\n      console.log('Question changed, loading data for:', currentQuestionData.questionId);\r\n      \r\n      setErrors({});\r\n      setShowSuccess(false);\r\n      setStartTime(Date.now());\r\n      setLastQuestionId(currentQuestionData.questionId);\r\n      setIsNavigating(false);\r\n      setNavigationDirection(null);\r\n      setQualityWarnings([]);\r\n      \r\n      if (isAttentionCheck) {\r\n        // We're showing an attention check, keep answer cleared\r\n        setAnswer('');\r\n      } else {\r\n        // Check if this matches our pre-attention data\r\n        if (preAttentionData && preAttentionData.questionData.questionId === currentQuestionData.questionId) {\r\n          console.log('🔄 Restoring pre-attention data for:', currentQuestionData.questionId);\r\n          setAnswer(preAttentionData.answer);\r\n          setStartTime(preAttentionData.startTime);\r\n          // Clear preAttentionData since we're now back to the original question\r\n          setPreAttentionData(null);\r\n        } else {\r\n          // Normal question loading - check for existing response\r\n          const existingResponse = state.responses.get(currentQuestionData.questionId);\r\n          if (existingResponse) {\r\n            console.log('Found existing response:', existingResponse.answer.substring(0, 50) + '...');\r\n            setAnswer(existingResponse.answer);\r\n          } else {\r\n            console.log('No existing response, clearing form');\r\n            setAnswer('');\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }, [currentQuestionData?.questionId, lastQuestionId, state.responses, isAttentionCheck, preAttentionData]);\r\n\r\n  // Auto-resize textarea\r\n  useEffect(() => {\r\n    if (textareaRef.current) {\r\n      textareaRef.current.style.height = 'auto';\r\n      textareaRef.current.style.height = textareaRef.current.scrollHeight + 'px';\r\n    }\r\n  }, [answer]);\r\n\r\n  const validateForm = () => {\r\n    const newErrors: { answer?: string } = {};\r\n    \r\n    const answerValidation = validateAnswer(answer);\r\n    if (!answerValidation.isValid) {\r\n      newErrors.answer = answerValidation.message;\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleAnswerChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n    const newValue = e.target.value;\r\n    setAnswer(newValue);\r\n    \r\n    if (errors.answer) {\r\n      setErrors(prev => ({ ...prev, answer: undefined }));\r\n    }\r\n\r\n    // More conservative real-time quality feedback\r\n    // Only show for very obvious issues and not during attention checks\r\n    if (newValue.length > 10 && !isAttentionCheck && !isNearSurveyEnd()) {\r\n      const qualityAnalysis = analyzeResponseQuality(newValue);\r\n      // Only show warnings for very low quality responses (score < 20)\r\n      if (qualityAnalysis.isLowQuality && qualityAnalysis.score < 20) {\r\n        setQualityWarnings(qualityAnalysis.issues.slice(0, 2)); // Limit to 2 warnings\r\n      } else {\r\n        setQualityWarnings([]);\r\n      }\r\n    } else {\r\n      setQualityWarnings([]);\r\n    }\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setAnswer('');\r\n    setErrors({});\r\n    setShowSuccess(false);\r\n    setQualityWarnings([]);\r\n    if (textareaRef.current) {\r\n      textareaRef.current.focus();\r\n    }\r\n  };\r\n\r\n  const checkForMilestones = () => {\r\n    const { categoryIndex, subcategoryIndex, topicIndex, questionIndex } = state.currentPosition;\r\n    const currentCategory = state.questionsData[categoryIndex];\r\n    const currentSubcategory = currentCategory?.subcategories[subcategoryIndex];\r\n    const currentTopic = currentSubcategory?.topics[topicIndex];\r\n    \r\n    if (!currentTopic) return null;\r\n\r\n    if (questionIndex === currentTopic.questions.length - 1) {\r\n      if (topicIndex === currentSubcategory.topics.length - 1) {\r\n        if (subcategoryIndex === currentCategory.subcategories.length - 1) {\r\n          return {\r\n            type: 'category',\r\n            name: currentCategory.category,\r\n            subcategoryName: currentSubcategory.subcategory,\r\n            topicName: currentTopic.topic\r\n          };\r\n        }\r\n        return {\r\n          type: 'subcategory',\r\n          name: currentSubcategory.subcategory,\r\n          topicName: currentTopic.topic,\r\n          categoryName: currentCategory.category\r\n        };\r\n      }\r\n      return {\r\n        type: 'topic',\r\n        name: currentTopic.topic,\r\n        subcategoryName: currentSubcategory.subcategory,\r\n        categoryName: currentCategory.category\r\n      };\r\n    }\r\n    return null;\r\n  };\r\n\r\n  // UPDATED performSave to handle both regular and pre-attention data\r\n  const performSave = async (questionDataToUse?: any, answerToUse?: string, startTimeToUse?: number, qualityAnalysis?: any, skipSuccessMessage?: boolean) => {\r\n    const questionData = questionDataToUse || currentQuestionData;\r\n    const answerText = answerToUse || answer;\r\n    const timeStart = startTimeToUse || startTime;\r\n    \r\n    if (!questionData || !state.sessionId) {\r\n      console.error('Missing required data for save');\r\n      return false;\r\n    }\r\n\r\n    // For attention checks, create a special question ID using actual response count\r\n    const questionId = isAttentionCheck \r\n      ? `ATTENTION_CHECK_${getActualQuestionResponseCount()}_${questionData.questionId}`\r\n      : questionData.questionId;\r\n\r\n    const questionText = isAttentionCheck \r\n      ? attentionCheck.question \r\n      : questionData.question;\r\n\r\n    if (!qualityAnalysis) {\r\n      qualityAnalysis = analyzeResponseQuality(answerText);\r\n    }\r\n\r\n    setIsSaving(true);\r\n    \r\n    try {\r\n      const timeSpent = Math.floor((Date.now() - timeStart) / 1000);\r\n      \r\n      const response = {\r\n        sessionId: state.sessionId,\r\n        questionId: questionId,\r\n        categoryIndex: state.currentPosition.categoryIndex,\r\n        subcategoryIndex: state.currentPosition.subcategoryIndex,\r\n        topicIndex: state.currentPosition.topicIndex,\r\n        questionIndex: state.currentPosition.questionIndex,\r\n        category: questionData.category,\r\n        subcategory: questionData.subcategory,\r\n        topic: questionData.topic,\r\n        question: questionText,\r\n        answer: answerText.trim(),\r\n        timeSpent,\r\n        timestamp: new Date().toISOString(),\r\n        qualityScore: qualityAnalysis.score,\r\n        isAttentionCheck: isAttentionCheck,\r\n        attentionCheckType: isAttentionCheck ? attentionCheck.type : undefined,\r\n        expectedAnswer: isAttentionCheck ? attentionCheck.expectedAnswer : undefined\r\n      };\r\n\r\n      console.log('Saving response:', {\r\n        questionId,\r\n        isAttentionCheck,\r\n        answer: answerText.substring(0, 50) + '...',\r\n        totalResponses: state.responses.size,\r\n        qualityScore: qualityAnalysis.score\r\n      });\r\n\r\n      await saveResponse(response);\r\n      \r\n      // Only show success message if not skipped and not an attention check\r\n      if (!skipSuccessMessage && !isAttentionCheck) {\r\n        setShowSuccess(true);\r\n        setTimeout(() => setShowSuccess(false), 2000);\r\n      }\r\n      return true;\r\n      \r\n    } catch (error) {\r\n      console.error('SAVE ERROR:', error);\r\n      throw error;\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    if (!validateForm() || !currentQuestionData || !state.sessionId) {\r\n      console.log('Validation failed:', errors);\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const qualityAnalysis = analyzeResponseQuality(answer);\r\n      return await performSave(undefined, undefined, undefined, qualityAnalysis);\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      alert('Failed to save response. Please try again.');\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // FIXED handleNext function - REMOVED individual quality check before submit\r\n  const handleNext = async () => {\r\n    const isValid = validateForm();\r\n    if (!isValid) {\r\n      console.log('Form validation failed, cannot proceed');\r\n      return;\r\n    }\r\n\r\n    // Handle attention check validation\r\n    if (isAttentionCheck && attentionCheck) {\r\n      const expectedAnswers = attentionCheck.expectedAnswers || [attentionCheck.expectedAnswer];\r\n      const isAttentionCheckValid = validateAttentionCheck(answer, expectedAnswers);\r\n      \r\n      console.log('ATTENTION CHECK VALIDATION:', {\r\n        userAnswer: answer,\r\n        expectedAnswers: expectedAnswers,\r\n        isValid: isAttentionCheckValid,\r\n        attentionCheckType: attentionCheck.type\r\n      });\r\n      \r\n      if (!isAttentionCheckValid) {\r\n        console.log('❌ ATTENTION CHECK FAILED - Redirecting to completion');\r\n        \r\n        try {\r\n          await performSave();\r\n          console.log('Failed attention check response saved');\r\n        } catch (error) {\r\n          console.error('Error saving failed attention check:', error);\r\n        }\r\n        \r\n        if (state.sessionId) {\r\n          try {\r\n            await api.completeUser(state.sessionId, 'attention_check_failed');\r\n            console.log('Survey marked as completed due to attention check failure');\r\n          } catch (error) {\r\n            console.error('Error marking survey completed:', error);\r\n          }\r\n        }\r\n        \r\n        dispatch({ type: 'SET_ATTENTION_CHECK_FAILED', payload: true });\r\n        return;\r\n      } else {\r\n        console.log('✅ ATTENTION CHECK PASSED');\r\n        \r\n        // Save the attention check response\r\n        try {\r\n          await performSave();\r\n          console.log('Attention check response saved');\r\n        } catch (error) {\r\n          console.error('Error saving attention check:', error);\r\n        }\r\n        \r\n        // Save the pre-attention data if it exists\r\n        if (preAttentionData) {\r\n          console.log('💾 Saving pre-attention data:', preAttentionData.questionData.questionId);\r\n          try {\r\n            await performSave(\r\n              preAttentionData.questionData,\r\n              preAttentionData.answer,\r\n              preAttentionData.startTime,\r\n              undefined,\r\n              true // Skip success message\r\n            );\r\n            console.log('Pre-attention data saved successfully');\r\n          } catch (error) {\r\n            console.error('Error saving pre-attention data:', error);\r\n          }\r\n        }\r\n        \r\n        // Reset attention check state and clear pre-attention data\r\n        setIsAttentionCheck(false);\r\n        setAttentionCheck(null);\r\n        \r\n        // TRIGGER NAVIGATION with animation\r\n        setNavigationDirection('next');\r\n        setIsNavigating(true);\r\n        \r\n        setTimeout(() => {\r\n          // Clear the answer field to prevent wrong answer from showing\r\n          setAnswer('');\r\n          setPreAttentionData(null);\r\n          \r\n          // Force re-render by updating the question ID tracker\r\n          setLastQuestionId(null);\r\n        }, 300);\r\n        \r\n        return;\r\n      }\r\n    }\r\n\r\n    // Regular question flow - REMOVED individual quality check before submit\r\n    // This prevents quality modals from showing right before submission\r\n    try {\r\n      const saveSuccessful = await handleSave();\r\n      \r\n      if (saveSuccessful && isValid) {\r\n        // If we have pre-attention data and we're saving the same question, clear it\r\n        if (\r\n          preAttentionData &&\r\n          currentQuestionData &&\r\n          preAttentionData.questionData.questionId === currentQuestionData.questionId\r\n        ) {\r\n          console.log('Clearing pre-attention data after saving the same question');\r\n          setPreAttentionData(null);\r\n        }\r\n        \r\n        const milestone = checkForMilestones();\r\n        \r\n        setNavigationDirection('next');\r\n        setIsNavigating(true);\r\n        \r\n        setTimeout(() => {\r\n          navigateToNext();\r\n          \r\n          if (milestone && !isAttentionCheck) {\r\n            setShowCelebration({type: milestone.type, data: milestone});\r\n          }\r\n        }, 300);\r\n      }\r\n    } catch (error) {\r\n      console.error('Next navigation failed:', error);\r\n    }\r\n  };\r\n\r\n  const handlePrevious = () => {\r\n    setNavigationDirection('previous');\r\n    setIsNavigating(true);\r\n    \r\n    setTimeout(() => {\r\n      navigateToPrevious();\r\n    }, 300);\r\n  };\r\n\r\n  const handleSkip = () => {\r\n    if (isAttentionCheck) return; // Don't allow skipping attention checks\r\n    \r\n    setAnswer('');\r\n    setErrors({});\r\n    \r\n    setNavigationDirection('next');\r\n    setIsNavigating(true);\r\n    \r\n    setTimeout(() => {\r\n      navigateToNext();\r\n    }, 300);\r\n  };\r\n\r\n  const handleQualityModalClose = () => {\r\n    console.log('Quality modal closed - user will improve response');\r\n    setShowQualityModal(false);\r\n    \r\n    // Clear the current answer to force them to rewrite\r\n    setAnswer('');\r\n    setErrors({});\r\n    setQualityWarnings([]);\r\n    \r\n    // Reset the quality issue state\r\n    setCurrentQualityIssue({\r\n      type: null,\r\n      noneRate: 0,\r\n      gibberishRate: 0,\r\n      speedRate: 0\r\n    });\r\n    \r\n    setTimeout(() => {\r\n      if (textareaRef.current) {\r\n        textareaRef.current.focus();\r\n      }\r\n    }, 100);\r\n  };\r\n\r\n  const closeCelebration = () => {\r\n    setShowCelebration(null);\r\n  };\r\n\r\n  if (!currentQuestionData) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gray-100 flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n          <p className=\"text-gray-600\">Loading question...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (state.surveyExpired) {\r\n    return null;\r\n  }\r\n\r\n  const isFirstQuestion = state.currentPosition.categoryIndex === 0 && \r\n                         state.currentPosition.subcategoryIndex === 0 && \r\n                         state.currentPosition.topicIndex === 0 && \r\n                         state.currentPosition.questionIndex === 0;\r\n\r\n  const isFormValid = answer.trim().length >= 4;\r\n  const displayQuestion = isAttentionCheck ? attentionCheck.question : currentQuestionData.question;\r\n\r\n  if (attentionCheckFailed) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div \r\n      className=\"min-h-screen\"\r\n      style={{ \r\n        background: `linear-gradient(135deg, var(--bg-primary) 0%, var(--color-cream) 50%, var(--bg-secondary) 100%)` \r\n      }}\r\n    >\r\n      <SurveyTimer />\r\n      <ProgressBar />\r\n\r\n      {!isAttentionCheck && (\r\n        <QualityWarningModal\r\n          isOpen={showQualityModal}\r\n          onClose={handleQualityModalClose}\r\n          qualityIssues={qualityWarnings}\r\n          issueType={currentQualityIssue.type}\r\n          noneResponseRate={currentQualityIssue.noneRate}\r\n          gibberishResponseRate={currentQualityIssue.gibberishRate}\r\n          fastResponseRate={currentQualityIssue.speedRate}\r\n        />\r\n      )}\r\n      \r\n      {showCelebration && (\r\n        <CelebrationModal \r\n          celebration={showCelebration} \r\n          onClose={closeCelebration}\r\n        />\r\n      )}\r\n      \r\n      <div className=\"max-w-4xl mx-auto px-4 py-6\">\r\n        <div className=\"relative overflow-hidden\">\r\n          <div className={`transform transition-all duration-500 ease-in-out ${\r\n            isNavigating \r\n              ? navigationDirection === 'next' \r\n                ? '-translate-x-full opacity-0'\r\n                : 'translate-x-full opacity-0'\r\n              : 'translate-x-0 opacity-100'\r\n          }`}>\r\n\r\n            <div \r\n              className=\"backdrop-blur-sm rounded-2xl shadow-lg overflow-hidden\"\r\n              style={{ \r\n                backgroundColor: 'var(--bg-card)',\r\n                border: '1px solid var(--border-light)'\r\n              }}\r\n            >\r\n              \r\n              <div \r\n                className=\"p-6\"\r\n                style={{ \r\n                  background: 'var(--bg-card-header)',\r\n                  color: 'var(--text-on-dark)'\r\n                }}\r\n              >\r\n                {isAttentionCheck && (\r\n                  <div className=\"mb-3 text-sm font-medium\" style={{ color: 'var(--text-on-dark)' }}>\r\n                    🔍 Attention Check\r\n                  </div>\r\n                )}\r\n                <h2 className=\"text-lg md:text-xl font-medium leading-relaxed\">\r\n                  {displayQuestion}\r\n                </h2>\r\n              </div>\r\n\r\n              <div className=\"p-6\">\r\n                <div className=\"mb-6\">\r\n                  <div className=\"flex justify-between items-center mb-3\">\r\n                    <label \r\n                      className=\"block text-base font-medium\"\r\n                      style={{ color: 'var(--text-primary)' }}\r\n                    >\r\n                      <span>Your Answer *</span>\r\n                      <span \r\n                        className=\"block text-xs font-normal mt-1\"\r\n                        style={{ color: 'var(--text-secondary)' }}\r\n                      >\r\n                        You can specify \"none\" if no answer exists\r\n                      </span>\r\n                    </label>\r\n                    <button\r\n                      onClick={handleClear}\r\n                      className=\"text-sm font-medium hover:underline transition-colors\"\r\n                      style={{ color: 'var(--accent-warning)' }}\r\n                    >\r\n                      Clear Form\r\n                    </button>\r\n                  </div>\r\n                  \r\n                  <div className=\"relative\">\r\n                    <textarea\r\n                      ref={textareaRef}\r\n                      value={answer}\r\n                      onChange={handleAnswerChange}\r\n                      placeholder=\"Share your knowledge about cultural practices in your region, or specify 'none' if no answer exists...\"\r\n                      className={`w-full px-4 py-3 border-2 rounded-xl resize-none min-h-[120px] transition-all duration-200 ${\r\n                        errors.answer ? 'focus:border-red-400' : ''\r\n                      }`}\r\n                      style={{\r\n                        color: 'var(--text-primary)',\r\n                        borderColor: errors.answer ? 'var(--accent-error)' : 'var(--border-medium)',\r\n                        backgroundColor: 'rgba(244, 228, 202, 0.3)'\r\n                      }}\r\n                      maxLength={5000}\r\n                      disabled={isSaving}\r\n                    />\r\n                    \r\n                    <div \r\n                      className={`absolute bottom-3 right-3 px-2 py-1 rounded-lg text-xs border`}\r\n                      style={{\r\n                        backgroundColor: answer.length >= 4 ? 'var(--color-cream)' : '#fef3c7',\r\n                        color: answer.length >= 4 ? 'var(--text-secondary)' : 'var(--accent-warning)',\r\n                        borderColor: answer.length >= 4 ? 'var(--border-light)' : '#fbbf24'\r\n                      }}\r\n                    >\r\n                      {answer.length}/5000 {answer.length < 4 && `(${4 - answer.length} more needed)`}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {errors.answer && (\r\n                    <p className=\"text-sm mt-2 font-medium\" style={{ color: 'var(--accent-error)' }}>\r\n                      {errors.answer}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                {!isAttentionCheck && qualityWarnings.length > 0 && !isNearSurveyEnd() && (\r\n                  <div \r\n                    className=\"mb-4 p-3 border rounded-xl\"\r\n                    style={{ \r\n                      background: 'var(--btn-warning-bg)',\r\n                      borderColor: '#fbbf24'\r\n                    }}\r\n                  >\r\n                    <div className=\"flex items-start\">\r\n                      <span style={{ color: 'var(--accent-warning)' }} className=\"mr-2\">⚠️</span>\r\n                      <div className=\"text-sm\" style={{ color: '#92400e' }}>\r\n                        <p className=\"font-medium mb-1\">Response Quality Notice:</p>\r\n                        <ul className=\"text-xs space-y-1\">\r\n                          {qualityWarnings.map((warning, index) => (\r\n                            <li key={index}>• {warning}</li>\r\n                          ))}\r\n                        </ul>\r\n                        <p className=\"mt-2 font-medium\">\r\n                          Please provide detailed responses or specify \"none\" if not applicable.\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {showSuccess && (\r\n                  <div \r\n                    className=\"mb-4 p-3 border rounded-xl animate-bounce-in\"\r\n                    style={{ \r\n                      background: 'var(--accent-success)',\r\n                      borderColor: 'var(--border-dark)',\r\n                      color: 'var(--text-on-dark)'\r\n                    }}\r\n                  >\r\n                    <div className=\"flex items-center\">\r\n                      <span className=\"mr-2\">✨</span>\r\n                      <span className=\"font-medium text-sm\">Response saved successfully!</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {!isFormValid && (\r\n                  <div \r\n                    className=\"mb-4 p-3 border rounded-xl\"\r\n                    style={{ \r\n                      background: 'var(--btn-warning-bg)',\r\n                      borderColor: '#fbbf24'\r\n                    }}\r\n                  >\r\n                    <div className=\"flex items-start\">\r\n                      <span style={{ color: 'var(--accent-warning)' }} className=\"mr-2\">⚠️</span>\r\n                      <div className=\"text-sm\" style={{ color: '#92400e' }}>\r\n                        <p className=\"font-medium mb-1\">Please complete the following:</p>\r\n                        <ul className=\"text-xs space-y-1\">\r\n                          <li>• Add at least 4 characters to your answer or specify \"none\"</li>\r\n                        </ul>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <div \r\n                  className=\"flex justify-between items-center pt-4 border-t\"\r\n                  style={{ borderColor: 'var(--border-light)' }}\r\n                >\r\n                  <button\r\n                    onClick={handlePrevious}\r\n                    disabled={isFirstQuestion || isNavigating || isAttentionCheck}\r\n                    className=\"flex items-center px-4 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\"\r\n                    style={{ \r\n                      background: 'var(--btn-warning-bg)',\r\n                      color: '#92400e'\r\n                    }}\r\n                  >\r\n                    <span className=\"mr-2\">←</span>\r\n                    Previous\r\n                  </button>\r\n\r\n                  <div className=\"flex space-x-3\">\r\n                    {!isAttentionCheck && (\r\n                      <button\r\n                        onClick={handleSkip}\r\n                        disabled={isNavigating}\r\n                        className=\"px-4 py-2 font-medium rounded-xl transition-all duration-200 text-sm\"\r\n                        style={{ \r\n                          background: 'var(--btn-warning-bg)',\r\n                          color: '#92400e'\r\n                        }}\r\n                      >\r\n                        Skip\r\n                      </button>\r\n                    )}\r\n\r\n                    <button\r\n                      onClick={handleSave}\r\n                      disabled={isSaving || !isFormValid || isNavigating}\r\n                      className=\"px-4 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\"\r\n                      style={{ \r\n                        background: 'var(--btn-secondary-bg)',\r\n                        color: 'var(--text-on-dark)'\r\n                      }}\r\n                    >\r\n                      {isSaving ? 'Saving...' : 'Save'}\r\n                    </button>\r\n\r\n                    <button\r\n                      onClick={handleNext}\r\n                      disabled={isSaving || !isFormValid || isNavigating}\r\n                      className=\"flex items-center px-5 py-2 font-medium rounded-xl transition-all duration-200 disabled:cursor-not-allowed text-sm disabled:opacity-50\"\r\n                      style={{ \r\n                        background: 'var(--btn-primary-bg)',\r\n                        color: 'var(--text-on-dark)'\r\n                      }}\r\n                    >\r\n                      {isNavigating ? 'Moving...' : (\r\n                        <>\r\n                          Save & Continue\r\n                          <span className=\"ml-2\">→</span>\r\n                        </>\r\n                      )}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Celebration Modal Component\r\nfunction CelebrationModal({ celebration, onClose }: { \r\n  celebration: {type: string, data: any}, \r\n  onClose: () => void \r\n}) {\r\n  const celebrations = {\r\n    topic: {\r\n      icon: '🎯',\r\n      title: 'Section Completed!',\r\n      message: 'Great progress! Keep going!'\r\n    },\r\n    subcategory: {\r\n      icon: '🏆',\r\n      title: 'Section Mastered!',\r\n      message: 'Excellent work! Moving to next section!'\r\n    },\r\n    category: {\r\n      icon: '👑',\r\n      title: 'Major Section Complete!',\r\n      message: 'Outstanding! You\\'re making great progress!'\r\n    }\r\n  };\r\n\r\n  const config = celebrations[celebration.type as keyof typeof celebrations];\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4\">\r\n      <div \r\n        className=\"rounded-2xl p-6 max-w-lg mx-auto text-center shadow-2xl animate-bounce-in\"\r\n        style={{ \r\n          backgroundColor: 'var(--bg-card)',\r\n          border: '1px solid var(--border-light)'\r\n        }}\r\n      >\r\n        <div className=\"text-5xl mb-3\">{config.icon}</div>\r\n        <h2 \r\n          className=\"text-2xl font-bold mb-3\"\r\n          style={{ color: 'var(--text-primary)' }}\r\n        >\r\n          {config.title}\r\n        </h2>\r\n        <p \r\n          className=\"text-lg mb-4\"\r\n          style={{ color: 'var(--text-secondary)' }}\r\n        >\r\n          {config.message}\r\n        </p>\r\n        <button\r\n          onClick={onClose}\r\n          className=\"px-6 py-2 font-medium rounded-xl transition-all duration-200\"\r\n          style={{ \r\n            background: 'var(--btn-primary-bg)',\r\n            color: 'var(--text-on-dark)'\r\n          }}\r\n        >\r\n          Continue Survey\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}